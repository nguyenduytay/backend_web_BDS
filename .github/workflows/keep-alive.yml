# yaml-language-server: disable
name: Keep Render Alive

on:
  schedule:
    # Ch·∫°y m·ªói 5 ph√∫t ƒë·ªÉ tr√°nh Render ng·ªß
    - cron: "*/5 * * * *"
  workflow_dispatch: # Cho ph√©p ch·∫°y th·ªß c√¥ng

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Ping Render Health Endpoint
        run: |
          RENDER_URL="${{ secrets.RENDER_URL || 'https://backend-web-bds.onrender.com' }}"
          HEALTH_URL="$RENDER_URL/health"

          echo "üöÄ Pinging Render to keep it alive..."
          echo "üìç URL: $HEALTH_URL"
          echo "‚è∞ Time: $(date)"

          # Ping v·ªõi timeout 30s
          HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" --max-time 30 "$HEALTH_URL" || echo "000")

          if [ "$HTTP_CODE" = "200" ]; then
            echo "‚úÖ Success! Render is alive (HTTP $HTTP_CODE)"
            # L·∫•y response ƒë·ªÉ xem chi ti·∫øt
            curl -s --max-time 30 "$HEALTH_URL" | head -c 200
            echo ""
            exit 0
          else
            echo "‚ö†Ô∏è Warning: HTTP $HTTP_CODE (Render might be sleeping or error)"
            echo "üí° This is normal if Render is sleeping - it will wake up on next request"
            exit 0  # Kh√¥ng fail workflow, ch·ªâ c·∫£nh b√°o
          fi
        env:
          RENDER_URL: ${{ secrets.RENDER_URL || 'https://backend-web-bds.onrender.com' }}
